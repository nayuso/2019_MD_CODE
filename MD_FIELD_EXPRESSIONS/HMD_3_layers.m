%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% MAGNETIC FIELD SOMMERFELD INTEGRALS DUE TO A HMD
% 3-LAYERS MODEL: AIR-SOIL1-SOIL2
%
%   z
%   ^  
%   |
%   | ·(px, py, pz)        AIR   
%   -----------------------------------> rho
%   |                               ^
%   |                               |
%   |                               |
%   | * (he)            MEDIUM 1    d
%   |                               |
%   |                               |
%   |                               v
%   ----------------------------------
%   |
%   |                   MEDIUM 2
%
%
% Observation point: px, py, py
% Source: he, hr
% Axial symmetry: cylindrical coordinate system
%
%
% AUTHORS:  PhD. Natalia Ayuso Escuer at nayuso@unizar.es
%           PhD. Francisco Lera García
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% VARIABLES DESCRIPTION
%
% m0: magnetic moment
% f: frequency
% he: z coordiante-source
% px: x coordiante-observation point
% py: y coordinate-observation point
% pz: z coordiante-observation point
% d: width layer 1
% sigma1: medium 1 conductivity
% sigma2: medium 2 conductivity
% e1: medium 1 relative permittivity
% e2: medium 2 relative permittivity
% disp_current: 1--> displacement currents neglected; 
% TOLABSx: Absolute Tolerance for x (y or z) component
% TOLRELx: Relative Tolerance for x (y or z) component
% c_ref: Coordinate system for magnetic field expressions
% normalization: 1-->change of integration variable, 0-->h=1
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


function H3H = HMD_3_layers (m0,f,he,px,py,pz,d,sigma1,sigma2,e1,e2,disp_current,ULIMx,ULIMy,ULIMz,TOLABSx,TOLABSy,TOLABSz,TOLRELx,TOLRELy,TOLRELz,c_ref,normalization)

global mu0 e0

%Rx-med
if pz >= 0
    kc = kc0;
elseif pz < (-d)
    kc = kc2;
else
    kc = kc1;
end

%Used for normalization
if he<0
    h=abs(he);
elseif hr<0
    h = abs(hr);
else
    h = 1;
end

if h<1
    h=1;
end

if normalization==0
    h=1;
end

%PRIMARY FIELDS
j = sqrt(-1);
w = 2*pi*f;
ec1 = e1 - j*(sigma1/w);  %complex permittivity of med1
ec2 = e2 - j*(sigma2/w);  %complex permittivity of med2

if disp_current == 1  %if displacement currents are neglected
    kc0 = 0;
    kc1 = sqrt(-j*mu0*sigma1*w); 
    kc2 = sqrt(-j*mu0*sigma2*w);
else
    kc0 = w*sqrt(mu0*e0);
    kc1 = w*sqrt(mu0*ec1); 
    kc2 = w*sqrt(mu0*ec2);
end

R = sqrt(px.^2+py.^2+(pz-he).^2); 

Hx_k1H = (m0/(4*pi))*((3./(R.^3))+(3*j*kc./(R.^2))-(kc.^2./R)).*(px*py)./(R.^2).*exp(-j*kc.*R);
Hy_k1H =(m0/(4*pi))*(((3./(R.^3))+(3*j*kc./(R.^2))-(kc.^2./R)).*(py.^2)./(R.^2) - ((1./(R.^3))+(j*kc./(R.^2))-(kc.^2./R))).*exp(-j*kc.*R);
Hz_k1H = (m0/(4*pi))*((3./(R.^3))+(3*j*kc./(R.^2))-(kc.^2./R)).*(py*(pz-he))./(R.^2).*exp(-j*kc.*R);

%SECONDARY FIELDS
Hx_k3H = (m0./(4*pi*(h^3))).*integral(@(x)HMD_integrand_3layers(x,f,he,px,py,pz,d,sigma1,sigma2,e1,e2,0,disp_current,normalization),0,ULIMx,'AbsTol',TOLABSx,'Reltol',TOLRELx);
Hy_k3H = (m0./(4*pi*(h^3))).*integral(@(x)HMD_integrand_3layers(x,f,he,px,py,pz,d,sigma1,sigma2,e1,e2,1,disp_current,normalization),0,ULIMy,'AbsTol',TOLABSy,'Reltol',TOLRELy);
Hz_k3H = (m0./(4*pi*(h^3))).*integral(@(x)HMD_integrand_3layers(x,f,he,px,py,pz,d,sigma1,sigma2,e1,e2,2,disp_current,normalization),0,ULIMz,'AbsTol',TOLABSz,'Reltol',TOLRELz);

%SOURCE AND OBSERVER IN THE SAME MEDIUM: PRIMARY + SECONDARY
%Tx-Rx in air=(he >= 0)&(pz >=0))
%Tx-Rx in medium 2=((he <= -d)&(pz <= -d))
%Tx-Rx in medium 1=(pz <= -d))|(((-d < he)&(he < 0))&((-d < pz)&(pz < 0))
%if (((-d < he)&(he < 0))&((-d < pz)&(pz < 0)))
%if ((he >= 0)&(pz >=0))|((he <= -d)&(pz <= -d))|(((-d < he)&(he < 0))&((-d < pz)&(pz < 0))
if ((he >= 0)&(pz >=0))|((he < -d)&(pz < -d))|(((-d <= he)&(he < 0))&((-d <= pz)&(pz < 0)))
    Hx_k3H = Hx_k3H + Hx_k1H;
    Hy_k3H = Hy_k3H + Hy_k1H;
    Hz_k3H = Hz_k3H + Hz_k1H;
end

switch c_ref
    case 'cartesian'
        H3H = [Hx_k3H;Hy_k3H;Hz_k3H];
    case 'cylindric'
        if px == 0
            phi = pi/2; %Eliminamos el warning de divisiï¿½n por cero
        else
            phi = atan2(py,px);
        end
        Hr_c3H =    cos(phi).*Hx_k3H + sin(phi).*Hy_k3H;
        Hphi_c3H = -sin(phi).*Hx_k3H + cos(phi).*Hy_k3H;
        Hz_c3H =                                        Hz_k3H;
        H3H = [Hr_c3H;Hphi_c3H;Hz_c3H]; 
    case 'spheric'
        if ((pz == 0)&(px ==0)& (py == 0))
            tita = 0;
        else
            tita = acos(pz./sqrt(px.^2+py.^2+pz.^2));
        end
        Hr_e3H =    sin(tita).*cos(phi).*Hx_k3H + sin(tita).*sin(phi).*Hy_k3H + cos(tita).*Hz_k3H;
        Htita_e3H = cos(tita).*cos(phi).*Hx_k3H + cos(tita).*sin(phi).*Hy_k3H - sin(tita).*Hz_k3H;
        Hphi_e3H =            -sin(phi).*Hx_k3H +            cos(phi).*Hy_k3H;
        H3H= [Hr_e3H; Htita_e3H; Hz_c3H]; 
end


function Hint = HMD_integrand_3layers (x,f,he,px,py,pz,d,sigma1,sigma2,e1,e2,component,disp_current,normalization)



%%%%%%%%%%%%%%%%%%%%%%
% CONSTANTES
%%%%%%%%%%%%%%%%%%%%%%
global mu0 e0;

%%%%%%%%%%%%%
% VARIABLES     
%%%%%%%%%%%%%
if normalization==1
    if he<0
        h=abs(he);
    elseif pz<0
        h = abs(pz);
    else
        h = 1;
    end
else
   h=1;
end

if h<1
    h=1;
end

j = sqrt(-1);
w = 2*pi*f;
rho = sqrt(px.^2 + py.^2); 

if disp_current == 1
    gamma0 = 0;
    gamma1 = sqrt(j*sigma1*mu0*w);   
    gamma2 = sqrt(j*sigma2*mu0*w);  
else
    gamma0 = sqrt(-(w^2*e0*mu0)); 
    gamma1 = sqrt((j*sigma1*mu0*w) - (w^2*e1*mu0)); 
    gamma2 = sqrt((j*sigma2*mu0*w) - (w^2*e2*mu0));  
end

k0=-j*gamma0;
k1=-j*gamma1;
k2=-j*gamma2;
 
u0 = sqrt((x/h).^2 + gamma0.^2); %propagation constant air,
u1 = sqrt((x/h).^2 + gamma1.^2); %medium 1,
u2 = sqrt((x/h).^2 + gamma2.^2); %medium 2

%TX-RX's mediums
emitter = 0; %EMITTER MEDIUM: 0 air of air-med1 interface; 1 med 1 or med1-2 interface; 2 med 2
if ((he < 0)&(he >= -d)) 
    emitter = 1;
elseif (he < -d)
    emitter = 2;
end

medium = 0; %RECEIVER MEDIUM: 0 air of air-med1 interface; 1 med 1; 2 med 2
if ((pz < 0)&(pz >= -d)) 
    medium = 1;
elseif pz < -d
    medium = 2;
end

%%%%%%%%%%%%
%INTEGRAND %
%%%%%%%%%%%%
%Bessel functions
J0 = besselj(0,(x/h)*rho); % funcion de bessel de primera especie y orden 0. Argumento rho*x
J1 = besselj(1,(x/h)*rho); % funcion de bessel de primera especie y orden 1. Argumento rho*x

R10v = ((k0.^2).*u1-(k1.^2).*u0)./((k0.^2).*u1+(k1.^2).*u0);
R01v = ((k1.^2).*u0-(k0.^2).*u1)./((k0.^2).*u1+(k1.^2).*u0);
R21v = ((k1.^2).*u2-(k2.^2).*u1)./((k1.^2).*u2+(k2.^2).*u1);
R12v = ((k2.^2).*u1-(k1.^2).*u2)./((k1.^2).*u2+(k2.^2).*u1);
R10h=(u1-u0)./(u0+u1);
R12h=(u1-u2)./(u1+u2);
T10v = (2*(k0.^2)*u1)./((k0.^2).*u1+(k1.^2).*u0);
T01h=2*u0./(u0+u1);
T10h=2*u1./(u1+u0);
N10=((k1.^2)-(k0.^2))./((k0.^2).*u1+(k1.^2).*u0);
  

if emitter == 0 %Source air
           
    
     if medium == 0 %Air or air-med1 interface
        if component == 0; %Hx
               Hint = exp(1) .^ ((-1) .* pz .* u0) .* h .* px .* py .* rho .^ (-2) .* x .* (( ...
              -2) .* J1 .* rho .^ (-1) + h .^ (-1) .* J0 .* x) .* ((-1) .* exp(1) .^ ( ...
              (-1) .* he .* u0) .* h .^ (-1) .* R01v .* u0 .^ (-1) .* x + (-2) .* exp( ...
              1) .^ ((-1) .* he .* u0 + (-2) .* d .* u1) .* h .^ (-1) .* k1 .^ 2 .*  ...
              R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ ( ...
              -1) .* T10v .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x + u0 .* ( ...
              N10 .* (exp(1) .^ ((-1) .* he .* u0) .* h .^ (-1) .* T01h .* u0 .^ (-1)  ...
              .* x + 2 .* exp(1) .^ ((-1) .* he .* u0 + (-2) .* d .* u1) .* h .^ (-1)  ...
              .* k0 .^ 2 .* R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v  ...
              .* R12v) .^ (-1) .* T10h .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .*  ...
              x) + (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10h .* R12h) .^ (-1)  ...
              .* (u1 + u2) .^ (-1) .* (2 .* exp(1) .^ ((-1) .* he .* u0 + (-2) .* d .* ...
               u1) .* h .^ (-1) .* k0 .^ 2 .* R12v .* (1 + (-1) .* exp(1) .^ ((-2) .*  ...
              d .* u1) .* R10v .* R12v) .^ (-1) .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^  ...
              (-1) .* (1 + R10v + exp(1) .^ ((-2) .* d .* u1) .* N10 .* R12h .* T10h  ...
              .* (u1 + u2)) .* x + exp(1) .^ ((-1) .* he .* u0 + (-2) .* d .* u1) .*  ...
              h .^ (-1) .* u0 .^ (-1) .* (2 .* k0 .^ 2 .* u0 .* (k1 .^ 2 .* u0 + k0  ...
              .^ 2 .* u1) .^ (-1) + ((-1) .* k0 .^ 2 + k1 .^ 2) .* R12h .* T01h .* ( ...
              k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* (u1 + u2)) .* x + (-1) .* exp( ...
              1) .^ ((-1) .* d .* u1) .* k1 .^ 2 .* k2 .^ (-2) .* (2 .* exp(1) .^ (( ...
              -1) .* he .* u0 + (-1) .* d .* u1) .* h .^ (-1) .* k0 .^ 2 .* R12v .* ( ...
              1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (k1  ...
              .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x + exp(1) .^ ((-1) .* d .* u1)  ...
              .* (2 .* exp(1) .^ ((-1) .* he .* u0) .* h .^ (-1) .* k0 .^ 2 .* (k1 .^  ...
              2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x + 2 .* exp(1) .^ ((-1) .* he .*  ...
              u0 + (-2) .* d .* u1) .* h .^ (-1) .* k0 .^ 2 .* R10v .* R12v .* (1 + ( ...
              -1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (k1 .^ 2  ...
              .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x))) + R10h .* (1 + (-1) .* exp(1) .^  ...
              ((-2) .* d .* u1) .* R10h .* R12h) .^ (-1) .* (u1 + u2) .^ (-1) .* (2 .* ...
               exp(1) .^ ((-1) .* he .* u0 + (-2) .* d .* u1) .* h .^ (-1) .* k0 .^ 2  ...
              .* R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^  ...
              (-1) .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* (1 + R10v + exp(1)  ...
              .^ ((-2) .* d .* u1) .* N10 .* R12h .* T10h .* (u1 + u2)) .* x + exp(1)  ...
              .^ ((-1) .* he .* u0 + (-2) .* d .* u1) .* h .^ (-1) .* u0 .^ (-1) .* ( ...
              2 .* k0 .^ 2 .* u0 .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) + ((-1) .* ...
               k0 .^ 2 + k1 .^ 2) .* R12h .* T01h .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1)  ...
              .^ (-1) .* (u1 + u2)) .* x + (-1) .* exp(1) .^ ((-1) .* d .* u1) .* k1  ...
              .^ 2 .* k2 .^ (-2) .* (2 .* exp(1) .^ ((-1) .* he .* u0 + (-1) .* d .*  ...
              u1) .* h .^ (-1) .* k0 .^ 2 .* R12v .* (1 + (-1) .* exp(1) .^ ((-2) .*  ...
              d .* u1) .* R10v .* R12v) .^ (-1) .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^  ...
              (-1) .* x + exp(1) .^ ((-1) .* d .* u1) .* (2 .* exp(1) .^ ((-1) .* he  ...
              .* u0) .* h .^ (-1) .* k0 .^ 2 .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ ( ...
              -1) .* x + 2 .* exp(1) .^ ((-1) .* he .* u0 + (-2) .* d .* u1) .* h .^ ( ...
              -1) .* k0 .^ 2 .* R10v .* R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .*  ...
              u1) .* R10v .* R12v) .^ (-1) .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1)  ...
              .* x)))));

        elseif component ==1 %Hy
              Hint = exp(1) .^ ((-1) .* pz .* u0) .* h .^ 2 .* J0 .* k0 .^ 2 .* (exp(1) .^ (( ...
              -1) .* he .* u0) .* h .^ (-1) .* R01v .* u0 .^ (-1) .* x + 2 .* exp(1)  ...
              .^ ((-1) .* he .* u0 + (-2) .* d .* u1) .* h .^ (-1) .* k1 .^ 2 .* R12v  ...
              .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .*  ...
              T10v .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x) + (-1) .* exp(1)  ...
              .^ ((-1) .* pz .* u0) .* h .* x .* (J1 .* ((-2) .* py .^ 2 .* rho .^ ( ...
              -3) + rho .^ (-1)) + h .^ (-1) .* J0 .* py .^ 2 .* rho .^ (-2) .* x) .*  ...
              (exp(1) .^ ((-1) .* he .* u0) .* h .^ (-1) .* R01v .* u0 .^ (-1) .* x +  ...
              2 .* exp(1) .^ ((-1) .* he .* u0 + (-2) .* d .* u1) .* h .^ (-1) .* k1  ...
              .^ 2 .* R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .*  ...
              R12v) .^ (-1) .* T10v .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x +  ...
              (-1) .* u0 .* (N10 .* (exp(1) .^ ((-1) .* he .* u0) .* h .^ (-1) .*  ...
              T01h .* u0 .^ (-1) .* x + 2 .* exp(1) .^ ((-1) .* he .* u0 + (-2) .* d  ...
              .* u1) .* h .^ (-1) .* k0 .^ 2 .* R12v .* (1 + (-1) .* exp(1) .^ ((-2)  ...
              .* d .* u1) .* R10v .* R12v) .^ (-1) .* T10h .* (k1 .^ 2 .* u0 + k0 .^  ...
              2 .* u1) .^ (-1) .* x) + (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .*  ...
              R10h .* R12h) .^ (-1) .* (u1 + u2) .^ (-1) .* (2 .* exp(1) .^ ((-1) .*  ...
              he .* u0 + (-2) .* d .* u1) .* h .^ (-1) .* k0 .^ 2 .* R12v .* (1 + (-1) ...
               .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (k1 .^ 2 .*  ...
              u0 + k0 .^ 2 .* u1) .^ (-1) .* (1 + R10v + exp(1) .^ ((-2) .* d .* u1)  ...
              .* N10 .* R12h .* T10h .* (u1 + u2)) .* x + exp(1) .^ ((-1) .* he .* u0  ...
              + (-2) .* d .* u1) .* h .^ (-1) .* u0 .^ (-1) .* (2 .* k0 .^ 2 .* u0 .*  ...
              (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) + ((-1) .* k0 .^ 2 + k1 .^ 2) .* ...
               R12h .* T01h .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* (u1 + u2))  ...
              .* x + (-1) .* exp(1) .^ ((-1) .* d .* u1) .* k1 .^ 2 .* k2 .^ (-2) .* ( ...
              2 .* exp(1) .^ ((-1) .* he .* u0 + (-1) .* d .* u1) .* h .^ (-1) .* k0  ...
              .^ 2 .* R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .*  ...
              R12v) .^ (-1) .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x + exp(1)  ...
              .^ ((-1) .* d .* u1) .* (2 .* exp(1) .^ ((-1) .* he .* u0) .* h .^ (-1)  ...
              .* k0 .^ 2 .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x + 2 .* exp(1) ...
               .^ ((-1) .* he .* u0 + (-2) .* d .* u1) .* h .^ (-1) .* k0 .^ 2 .*  ...
              R10v .* R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .*  ...
              R12v) .^ (-1) .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x))) + R10h  ...
              .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10h .* R12h) .^ (-1) .*  ...
              (u1 + u2) .^ (-1) .* (2 .* exp(1) .^ ((-1) .* he .* u0 + (-2) .* d .*  ...
              u1) .* h .^ (-1) .* k0 .^ 2 .* R12v .* (1 + (-1) .* exp(1) .^ ((-2) .*  ...
              d .* u1) .* R10v .* R12v) .^ (-1) .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^  ...
              (-1) .* (1 + R10v + exp(1) .^ ((-2) .* d .* u1) .* N10 .* R12h .* T10h  ...
              .* (u1 + u2)) .* x + exp(1) .^ ((-1) .* he .* u0 + (-2) .* d .* u1) .*  ...
              h .^ (-1) .* u0 .^ (-1) .* (2 .* k0 .^ 2 .* u0 .* (k1 .^ 2 .* u0 + k0  ...
              .^ 2 .* u1) .^ (-1) + ((-1) .* k0 .^ 2 + k1 .^ 2) .* R12h .* T01h .* ( ...
              k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* (u1 + u2)) .* x + (-1) .* exp( ...
              1) .^ ((-1) .* d .* u1) .* k1 .^ 2 .* k2 .^ (-2) .* (2 .* exp(1) .^ (( ...
              -1) .* he .* u0 + (-1) .* d .* u1) .* h .^ (-1) .* k0 .^ 2 .* R12v .* ( ...
              1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (k1  ...
              .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x + exp(1) .^ ((-1) .* d .* u1)  ...
              .* (2 .* exp(1) .^ ((-1) .* he .* u0) .* h .^ (-1) .* k0 .^ 2 .* (k1 .^  ...
              2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x + 2 .* exp(1) .^ ((-1) .* he .*  ...
              u0 + (-2) .* d .* u1) .* h .^ (-1) .* k0 .^ 2 .* R10v .* R12v .* (1 + ( ...
              -1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (k1 .^ 2  ...
              .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x)))));
        else %Hz     
            Hint = exp(1) .^ ((-1) .* pz .* u0) .* h .* J1 .* py .* rho .^ (-1) .* x .* ( ...
      u0 .* (exp(1) .^ ((-1) .* he .* u0) .* h .^ (-1) .* R01v .* u0 .^ (-1)  ...
      .* x + 2 .* exp(1) .^ ((-1) .* he .* u0 + (-2) .* d .* u1) .* h .^ (-1)  ...
      .* k1 .^ 2 .* R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v  ...
      .* R12v) .^ (-1) .* T10v .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .*  ...
      x) + (-1) .* h .^ (-2) .* x .^ 2 .* (N10 .* (exp(1) .^ ((-1) .* he .*  ...
      u0) .* h .^ (-1) .* T01h .* u0 .^ (-1) .* x + 2 .* exp(1) .^ ((-1) .*  ...
      he .* u0 + (-2) .* d .* u1) .* h .^ (-1) .* k0 .^ 2 .* R12v .* (1 + (-1) ...
       .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* T10h .* (k1  ...
      .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x) + (1 + (-1) .* exp(1) .^ ((-2) ...
       .* d .* u1) .* R10h .* R12h) .^ (-1) .* (u1 + u2) .^ (-1) .* (2 .* exp( ...
      1) .^ ((-1) .* he .* u0 + (-2) .* d .* u1) .* h .^ (-1) .* k0 .^ 2 .*  ...
      R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ ( ...
      -1) .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* (1 + R10v + exp(1) .^  ...
      ((-2) .* d .* u1) .* N10 .* R12h .* T10h .* (u1 + u2)) .* x + exp(1) .^  ...
      ((-1) .* he .* u0 + (-2) .* d .* u1) .* h .^ (-1) .* u0 .^ (-1) .* (2 .* ...
       k0 .^ 2 .* u0 .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) + ((-1) .* k0  ...
      .^ 2 + k1 .^ 2) .* R12h .* T01h .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ ( ...
      -1) .* (u1 + u2)) .* x + (-1) .* exp(1) .^ ((-1) .* d .* u1) .* k1 .^ 2  ...
      .* k2 .^ (-2) .* (2 .* exp(1) .^ ((-1) .* he .* u0 + (-1) .* d .* u1) .* ...
       h .^ (-1) .* k0 .^ 2 .* R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .*  ...
      u1) .* R10v .* R12v) .^ (-1) .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1)  ...
      .* x + exp(1) .^ ((-1) .* d .* u1) .* (2 .* exp(1) .^ ((-1) .* he .* u0) ...
       .* h .^ (-1) .* k0 .^ 2 .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .*  ...
      x + 2 .* exp(1) .^ ((-1) .* he .* u0 + (-2) .* d .* u1) .* h .^ (-1) .*  ...
      k0 .^ 2 .* R10v .* R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .*  ...
      R10v .* R12v) .^ (-1) .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x))) ...
       + R10h .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10h .* R12h) .^  ...
      (-1) .* (u1 + u2) .^ (-1) .* (2 .* exp(1) .^ ((-1) .* he .* u0 + (-2) .* ...
       d .* u1) .* h .^ (-1) .* k0 .^ 2 .* R12v .* (1 + (-1) .* exp(1) .^ (( ...
      -2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (k1 .^ 2 .* u0 + k0 .^ 2 .*  ...
      u1) .^ (-1) .* (1 + R10v + exp(1) .^ ((-2) .* d .* u1) .* N10 .* R12h .* ...
       T10h .* (u1 + u2)) .* x + exp(1) .^ ((-1) .* he .* u0 + (-2) .* d .*  ...
      u1) .* h .^ (-1) .* u0 .^ (-1) .* (2 .* k0 .^ 2 .* u0 .* (k1 .^ 2 .* u0  ...
      + k0 .^ 2 .* u1) .^ (-1) + ((-1) .* k0 .^ 2 + k1 .^ 2) .* R12h .* T01h  ...
      .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* (u1 + u2)) .* x + (-1) .*  ...
      exp(1) .^ ((-1) .* d .* u1) .* k1 .^ 2 .* k2 .^ (-2) .* (2 .* exp(1) .^  ...
      ((-1) .* he .* u0 + (-1) .* d .* u1) .* h .^ (-1) .* k0 .^ 2 .* R12v .*  ...
      (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* ( ...
      k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x + exp(1) .^ ((-1) .* d .*  ...
      u1) .* (2 .* exp(1) .^ ((-1) .* he .* u0) .* h .^ (-1) .* k0 .^ 2 .* ( ...
      k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x + 2 .* exp(1) .^ ((-1) .*  ...
      he .* u0 + (-2) .* d .* u1) .* h .^ (-1) .* k0 .^ 2 .* R10v .* R12v .* ( ...
      1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (k1  ...
      .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x)))));
    end
    elseif medium == 1 %medium 1
        if component == 0;     %Hx
            Hint = exp(1) .^ ((-1) .* he .* u0) .* h .^ (-1) .* k2 .^ (-2) .* px .* py .* ( ...
              1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10h .* R12h) .^ (-1) .* (1 + ...
               (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* rho .^  ...
              (-3) .* u0 .^ (-1) .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* (u1 +  ...
              u2) .^ (-1) .* ((-1) .* exp(1) .^ (pz .* u1) .* k2 .^ 2 .* (k1 .^ 2 .*  ...
              N10 .* T01h .* u0 .* u1 + k0 .^ 2 .* (2 .* u0 + N10 .* T01h .* u1 .^ 2)) ...
               .* (u1 + u2) + (-1) .* exp(1) .^ ((-4) .* d .* u1 + pz .* u1) .* k2 .^  ...
              2 .* R10h .* R10v .* R12v .* u1 .* (k1 .^ 2 .* R12h .* T01h .* ((-1) +  ...
              N10 .* u0) .* (u1 + u2) + k0 .^ 2 .* ((-2) .* u0 + R12h .* T01h .* (1 +  ...
              N10 .* u1) .* (u1 + u2))) + exp(1) .^ ((-4) .* d .* u1 + (-1) .* pz .*  ...
              u1) .* k2 .^ 2 .* R12v .* ((-1) .* k1 .^ 2 .* R10v .* R12h .* T01h .*  ...
              u1 .* (u1 + u2) + k0 .^ 2 .* (2 .* R12h .* u0 .* (R10h + N10 .* T10h .*  ...
              u1) .* (u1 + u2) + R10v .* u1 .* ((-2) .* u0 + R12h .* T01h .* (u1 + u2) ...
              ))) + exp(1) .^ ((-2) .* d .* u1 + (-1) .* pz .* u1) .* (k1 .^ 2 .* k2  ...
              .^ 2 .* R12h .* T01h .* u1 .* (u1 + u2) + (-1) .* k0 .^ 2 .* (2 .* k1  ...
              .^ 2 .* (1 + R12v) .* u0 .* u1 + k2 .^ 2 .* (R12h .* T01h .* u1 .* (u1 + ...
               u2) + (-2) .* u0 .* (u1 + R10v .* R12v .* u1 + (-1) .* R12v .* u2)))) + ...
               exp(1) .^ ((-2) .* d .* u1 + pz .* u1) .* (k1 .^ 2 .* k2 .^ 2 .* T01h  ...
              .* (N10 .* R10v .* R12v .* u0 + R10h .* R12h .* ((-1) + N10 .* u0)) .*  ...
              u1 .* (u1 + u2) + k0 .^ 2 .* (2 .* k1 .^ 2 .* R10h .* (1 + R12v) .* u0  ...
              .* u1 + k2 .^ 2 .* (N10 .* R12v .* u1 .* ((-2) .* T10h .* u0 + R10v .*  ...
              T01h .* u1) .* (u1 + u2) + R10h .* (R12h .* T01h .* u1 .* (1 + N10 .*  ...
              u1) .* (u1 + u2) + 2 .* u0 .* (((-1) + R12h + (-1) .* (1 + R10v) .*  ...
              R12v) .* u1 + R12h .* u2)))))) .* x .^ 2 .* ((-2) .* h .* J1 + J0 .*  ...
              rho .* x);

        elseif component == 1; %Hy
            Hint = h .^ 2 .* J0 .* k1 .^ 2 .* (2 .* exp(1) .^ ((-1) .* he .* u0 + ((-2) .*  ...
          d + (-1) .* pz) .* u1) .* h .^ (-1) .* k0 .^ 2 .* R12v .* (1 + (-1) .*  ...
          exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (k1 .^ 2 .* u0 + ...
           k0 .^ 2 .* u1) .^ (-1) .* x + exp(1) .^ (pz .* u1) .* (2 .* exp(1) .^ ( ...
          (-1) .* he .* u0) .* h .^ (-1) .* k0 .^ 2 .* (k1 .^ 2 .* u0 + k0 .^ 2 .* ...
           u1) .^ (-1) .* x + 2 .* exp(1) .^ ((-1) .* he .* u0 + (-2) .* d .* u1)  ...
          .* h .^ (-1) .* k0 .^ 2 .* R10v .* R12v .* (1 + (-1) .* exp(1) .^ ((-2)  ...
          .* d .* u1) .* R10v .* R12v) .^ (-1) .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1)  ...
          .^ (-1) .* x)) + (-1) .* h .* x .* (J1 .* ((-2) .* py .^ 2 .* rho .^ ( ...
          -3) + rho .^ (-1)) + h .^ (-1) .* J0 .* py .^ 2 .* rho .^ (-2) .* x) .*  ...
          (2 .* exp(1) .^ ((-1) .* he .* u0 + ((-2) .* d + (-1) .* pz) .* u1) .*  ...
          h .^ (-1) .* k0 .^ 2 .* R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) ...
           .* R10v .* R12v) .^ (-1) .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .*  ...
          x + exp(1) .^ (pz .* u1) .* (2 .* exp(1) .^ ((-1) .* he .* u0) .* h .^ ( ...
          -1) .* k0 .^ 2 .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x + 2 .*  ...
          exp(1) .^ ((-1) .* he .* u0 + (-2) .* d .* u1) .* h .^ (-1) .* k0 .^ 2  ...
          .* R10v .* R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .*  ...
          R12v) .^ (-1) .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x) + u1 .* ( ...
          (-1) .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10h .* R12h) .^ ( ...
          -1) .* (u1 + u2) .^ (-1) .* (2 .* exp(1) .^ ((-1) .* he .* u0 + ((-2) .* ...
           d + (-1) .* pz) .* u1) .* h .^ (-1) .* k0 .^ 2 .* R12v .* (1 + (-1) .*  ...
          exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (k1 .^ 2 .* u0 + ...
           k0 .^ 2 .* u1) .^ (-1) .* (1 + R10v + exp(1) .^ ((-2) .* d .* u1) .*  ...
          N10 .* R12h .* T10h .* (u1 + u2)) .* x + exp(1) .^ ((-1) .* he .* u0 + ( ...
          (-2) .* d + (-1) .* pz) .* u1) .* h .^ (-1) .* u0 .^ (-1) .* (2 .* k0  ...
          .^ 2 .* u0 .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) + ((-1) .* k0 .^  ...
          2 + k1 .^ 2) .* R12h .* T01h .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1)  ...
          .* (u1 + u2)) .* x + (-1) .* exp(1) .^ (((-1) .* d + (-1) .* pz) .* u1)  ...
          .* k1 .^ 2 .* k2 .^ (-2) .* (2 .* exp(1) .^ ((-1) .* he .* u0 + (-1) .*  ...
          d .* u1) .* h .^ (-1) .* k0 .^ 2 .* R12v .* (1 + (-1) .* exp(1) .^ ((-2) ...
           .* d .* u1) .* R10v .* R12v) .^ (-1) .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) ...
           .^ (-1) .* x + exp(1) .^ ((-1) .* d .* u1) .* (2 .* exp(1) .^ ((-1) .*  ...
          he .* u0) .* h .^ (-1) .* k0 .^ 2 .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^  ...
          (-1) .* x + 2 .* exp(1) .^ ((-1) .* he .* u0 + (-2) .* d .* u1) .* h .^  ...
          (-1) .* k0 .^ 2 .* R10v .* R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .*  ...
          u1) .* R10v .* R12v) .^ (-1) .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1)  ...
          .* x))) + exp(1) .^ (pz .* u1) .* (N10 .* (exp(1) .^ ((-1) .* he .* u0)  ...
          .* h .^ (-1) .* T01h .* u0 .^ (-1) .* x + 2 .* exp(1) .^ ((-1) .* he .*  ...
          u0 + (-2) .* d .* u1) .* h .^ (-1) .* k0 .^ 2 .* R12v .* (1 + (-1) .*  ...
          exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* T10h .* (k1 .^  ...
          2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x) + R10h .* (1 + (-1) .* exp(1) .^  ...
          ((-2) .* d .* u1) .* R10h .* R12h) .^ (-1) .* (u1 + u2) .^ (-1) .* (2 .* ...
           exp(1) .^ ((-1) .* he .* u0 + (-2) .* d .* u1) .* h .^ (-1) .* k0 .^ 2  ...
          .* R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^  ...
          (-1) .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* (1 + R10v + exp(1)  ...
          .^ ((-2) .* d .* u1) .* N10 .* R12h .* T10h .* (u1 + u2)) .* x + exp(1)  ...
          .^ ((-1) .* he .* u0 + (-2) .* d .* u1) .* h .^ (-1) .* u0 .^ (-1) .* ( ...
          2 .* k0 .^ 2 .* u0 .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) + ((-1) .* ...
           k0 .^ 2 + k1 .^ 2) .* R12h .* T01h .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1)  ...
          .^ (-1) .* (u1 + u2)) .* x + (-1) .* exp(1) .^ ((-1) .* d .* u1) .* k1  ...
          .^ 2 .* k2 .^ (-2) .* (2 .* exp(1) .^ ((-1) .* he .* u0 + (-1) .* d .*  ...
          u1) .* h .^ (-1) .* k0 .^ 2 .* R12v .* (1 + (-1) .* exp(1) .^ ((-2) .*  ...
          d .* u1) .* R10v .* R12v) .^ (-1) .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^  ...
          (-1) .* x + exp(1) .^ ((-1) .* d .* u1) .* (2 .* exp(1) .^ ((-1) .* he  ...
          .* u0) .* h .^ (-1) .* k0 .^ 2 .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ ( ...
          -1) .* x + 2 .* exp(1) .^ ((-1) .* he .* u0 + (-2) .* d .* u1) .* h .^ ( ...
          -1) .* k0 .^ 2 .* R10v .* R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .*  ...
          u1) .* R10v .* R12v) .^ (-1) .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1)  ...
          .* x))))));
        else                    %Hz
            Hint = h .* J1 .* py .* rho .^ (-1) .* x .* ((-1) .* u1 .* ((-2) .* exp(1) .^ ( ...
          (-1) .* he .* u0 + ((-2) .* d + (-1) .* pz) .* u1) .* h .^ (-1) .* k0  ...
          .^ 2 .* R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .*  ...
          R12v) .^ (-1) .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x + exp(1)  ...
          .^ (pz .* u1) .* (2 .* exp(1) .^ ((-1) .* he .* u0) .* h .^ (-1) .* k0  ...
          .^ 2 .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x + 2 .* exp(1) .^ (( ...
          -1) .* he .* u0 + (-2) .* d .* u1) .* h .^ (-1) .* k0 .^ 2 .* R10v .*  ...
          R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ ( ...
          -1) .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x)) + (-1) .* h .^ ( ...
          -2) .* x .^ 2 .* ((1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10h .*  ...
          R12h) .^ (-1) .* (u1 + u2) .^ (-1) .* (2 .* exp(1) .^ ((-1) .* he .* u0  ...
          + (-2) .* d .* u1 + (-1) .* pz .* u1) .* h .^ (-1) .* k0 .^ 2 .* R12v .* ...
           (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* ( ...
          k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* (1 + R10v + exp(1) .^ ((-2) .* ...
           d .* u1) .* N10 .* R12h .* T10h .* (u1 + u2)) .* x + exp(1) .^ ((-1) .* ...
           he .* u0 + (-2) .* d .* u1 + (-1) .* pz .* u1) .* h .^ (-1) .* u0 .^ ( ...
          -1) .* (2 .* k0 .^ 2 .* u0 .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) +  ...
          ((-1) .* k0 .^ 2 + k1 .^ 2) .* R12h .* T01h .* (k1 .^ 2 .* u0 + k0 .^ 2  ...
          .* u1) .^ (-1) .* (u1 + u2)) .* x + (-1) .* exp(1) .^ (((-1) .* d + (-1) ...
           .* pz) .* u1) .* k1 .^ 2 .* k2 .^ (-2) .* (2 .* exp(1) .^ ((-1) .* he  ...
          .* u0 + (-1) .* d .* u1) .* h .^ (-1) .* k0 .^ 2 .* R12v .* (1 + (-1) .* ...
           exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (k1 .^ 2 .* u0  ...
          + k0 .^ 2 .* u1) .^ (-1) .* x + exp(1) .^ ((-1) .* d .* u1) .* (2 .*  ...
          exp(1) .^ ((-1) .* he .* u0) .* h .^ (-1) .* k0 .^ 2 .* (k1 .^ 2 .* u0 + ...
           k0 .^ 2 .* u1) .^ (-1) .* x + 2 .* exp(1) .^ ((-1) .* he .* u0 + (-2)  ...
          .* d .* u1) .* h .^ (-1) .* k0 .^ 2 .* R10v .* R12v .* (1 + (-1) .* exp( ...
          1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (k1 .^ 2 .* u0 + k0  ...
          .^ 2 .* u1) .^ (-1) .* x))) + exp(1) .^ (pz .* u1) .* (N10 .* (exp(1)  ...
          .^ ((-1) .* he .* u0) .* h .^ (-1) .* T01h .* u0 .^ (-1) .* x + 2 .*  ...
          exp(1) .^ ((-1) .* he .* u0 + (-2) .* d .* u1) .* h .^ (-1) .* k0 .^ 2  ...
          .* R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^  ...
          (-1) .* T10h .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x) + R10h .*  ...
          (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10h .* R12h) .^ (-1) .* ( ...
          u1 + u2) .^ (-1) .* (2 .* exp(1) .^ ((-1) .* he .* u0 + (-2) .* d .* u1) ...
           .* h .^ (-1) .* k0 .^ 2 .* R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* ...
           u1) .* R10v .* R12v) .^ (-1) .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) ...
           .* (1 + R10v + exp(1) .^ ((-2) .* d .* u1) .* N10 .* R12h .* T10h .* ( ...
          u1 + u2)) .* x + exp(1) .^ ((-1) .* he .* u0 + (-2) .* d .* u1) .* h .^  ...
          (-1) .* u0 .^ (-1) .* (2 .* k0 .^ 2 .* u0 .* (k1 .^ 2 .* u0 + k0 .^ 2 .* ...
           u1) .^ (-1) + ((-1) .* k0 .^ 2 + k1 .^ 2) .* R12h .* T01h .* (k1 .^ 2  ...
          .* u0 + k0 .^ 2 .* u1) .^ (-1) .* (u1 + u2)) .* x + (-1) .* exp(1) .^ (( ...
          -1) .* d .* u1) .* k1 .^ 2 .* k2 .^ (-2) .* (2 .* exp(1) .^ ((-1) .* he  ...
          .* u0 + (-1) .* d .* u1) .* h .^ (-1) .* k0 .^ 2 .* R12v .* (1 + (-1) .* ...
           exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (k1 .^ 2 .* u0  ...
          + k0 .^ 2 .* u1) .^ (-1) .* x + exp(1) .^ ((-1) .* d .* u1) .* (2 .*  ...
          exp(1) .^ ((-1) .* he .* u0) .* h .^ (-1) .* k0 .^ 2 .* (k1 .^ 2 .* u0 + ...
           k0 .^ 2 .* u1) .^ (-1) .* x + 2 .* exp(1) .^ ((-1) .* he .* u0 + (-2)  ...
          .* d .* u1) .* h .^ (-1) .* k0 .^ 2 .* R10v .* R12v .* (1 + (-1) .* exp( ...
          1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (k1 .^ 2 .* u0 + k0  ...
          .^ 2 .* u1) .^ (-1) .* x))))));
        end
    else %medium 2
        if component == 0; %Hx
            Hint = h .* px .* py .* rho .^ (-2) .* x .* ((-2) .* J1 .* rho .^ (-1) + h .^ ( ...
      -1) .* J0 .* x) .* ((-1) .* exp(1) .^ ((d + pz) .* u2) .* k1 .^ 2 .* k2  ...
      .^ (-2) .* (2 .* exp(1) .^ ((-1) .* he .* u0 + (-1) .* d .* u1) .* h .^  ...
      (-1) .* k0 .^ 2 .* R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .*  ...
      R10v .* R12v) .^ (-1) .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x +  ...
      exp(1) .^ ((-1) .* d .* u1) .* (2 .* exp(1) .^ ((-1) .* he .* u0) .* h  ...
      .^ (-1) .* k0 .^ 2 .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x + 2  ...
      .* exp(1) .^ ((-1) .* he .* u0 + (-2) .* d .* u1) .* h .^ (-1) .* k0 .^  ...
      2 .* R10v .* R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* ...
       R12v) .^ (-1) .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x)) + (-1)  ...
      .* exp(1) .^ ((d + pz) .* u2) .* u2 .* ((1 + (-1) .* exp(1) .^ ((-2) .*  ...
      d .* u1) .* R10h .* R12h) .^ (-1) .* (u1 + u2) .^ (-1) .* (2 .* exp(1)  ...
      .^ ((-1) .* he .* u0 + (-1) .* d .* u1) .* h .^ (-1) .* k0 .^ 2 .* R12v  ...
      .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .*  ...
      (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* (1 + R10v + exp(1) .^ ((-2)  ...
      .* d .* u1) .* N10 .* R12h .* T10h .* (u1 + u2)) .* x + exp(1) .^ ((-1)  ...
      .* he .* u0 + (-1) .* d .* u1) .* h .^ (-1) .* u0 .^ (-1) .* (2 .* k0  ...
      .^ 2 .* u0 .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) + ((-1) .* k0 .^  ...
      2 + k1 .^ 2) .* R12h .* T01h .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1)  ...
      .* (u1 + u2)) .* x + (-1) .* k1 .^ 2 .* k2 .^ (-2) .* (2 .* exp(1) .^ (( ...
      -1) .* he .* u0 + (-1) .* d .* u1) .* h .^ (-1) .* k0 .^ 2 .* R12v .* ( ...
      1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (k1  ...
      .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x + exp(1) .^ ((-1) .* d .* u1)  ...
      .* (2 .* exp(1) .^ ((-1) .* he .* u0) .* h .^ (-1) .* k0 .^ 2 .* (k1 .^  ...
      2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x + 2 .* exp(1) .^ ((-1) .* he .*  ...
      u0 + (-2) .* d .* u1) .* h .^ (-1) .* k0 .^ 2 .* R10v .* R12v .* (1 + ( ...
      -1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (k1 .^ 2  ...
      .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x))) + exp(1) .^ ((-1) .* d .* u1) .*  ...
      (N10 .* (exp(1) .^ ((-1) .* he .* u0) .* h .^ (-1) .* T01h .* u0 .^ (-1) ...
       .* x + 2 .* exp(1) .^ ((-1) .* he .* u0 + (-2) .* d .* u1) .* h .^ (-1) ...
       .* k0 .^ 2 .* R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v  ...
      .* R12v) .^ (-1) .* T10h .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .*  ...
      x) + R10h .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10h .* R12h)  ...
      .^ (-1) .* (u1 + u2) .^ (-1) .* (2 .* exp(1) .^ ((-1) .* he .* u0 + (-2) ...
       .* d .* u1) .* h .^ (-1) .* k0 .^ 2 .* R12v .* (1 + (-1) .* exp(1) .^ ( ...
      (-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (k1 .^ 2 .* u0 + k0 .^ 2 .* ...
       u1) .^ (-1) .* (1 + R10v + exp(1) .^ ((-2) .* d .* u1) .* N10 .* R12h  ...
      .* T10h .* (u1 + u2)) .* x + exp(1) .^ ((-1) .* he .* u0 + (-2) .* d .*  ...
      u1) .* h .^ (-1) .* u0 .^ (-1) .* (2 .* k0 .^ 2 .* u0 .* (k1 .^ 2 .* u0  ...
      + k0 .^ 2 .* u1) .^ (-1) + ((-1) .* k0 .^ 2 + k1 .^ 2) .* R12h .* T01h  ...
      .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* (u1 + u2)) .* x + (-1) .*  ...
      exp(1) .^ ((-1) .* d .* u1) .* k1 .^ 2 .* k2 .^ (-2) .* (2 .* exp(1) .^  ...
      ((-1) .* he .* u0 + (-1) .* d .* u1) .* h .^ (-1) .* k0 .^ 2 .* R12v .*  ...
      (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* ( ...
      k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x + exp(1) .^ ((-1) .* d .*  ...
      u1) .* (2 .* exp(1) .^ ((-1) .* he .* u0) .* h .^ (-1) .* k0 .^ 2 .* ( ...
      k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x + 2 .* exp(1) .^ ((-1) .*  ...
      he .* u0 + (-2) .* d .* u1) .* h .^ (-1) .* k0 .^ 2 .* R10v .* R12v .* ( ...
      1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (k1  ...
      .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x))))));
     
        elseif component ==1 %Hy
            Hint =  exp(1) .^ ((d + pz) .* u2) .* h .^ 2 .* J0 .* k1 .^ 2 .* (2 .* exp(1)  ...
          .^ ((-1) .* he .* u0 + (-1) .* d .* u1) .* h .^ (-1) .* k0 .^ 2 .* R12v  ...
          .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .*  ...
          (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x + exp(1) .^ ((-1) .* d .*  ...
          u1) .* (2 .* exp(1) .^ ((-1) .* he .* u0) .* h .^ (-1) .* k0 .^ 2 .* ( ...
          k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x + 2 .* exp(1) .^ ((-1) .*  ...
          he .* u0 + (-2) .* d .* u1) .* h .^ (-1) .* k0 .^ 2 .* R10v .* R12v .* ( ...
          1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (k1  ...
          .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x)) + (-1) .* h .* x .* (J1 .* (( ...
          -2) .* py .^ 2 .* rho .^ (-3) + rho .^ (-1)) + h .^ (-1) .* J0 .* py .^  ...
          2 .* rho .^ (-2) .* x) .* (exp(1) .^ ((d + pz) .* u2) .* k1 .^ 2 .* k2  ...
          .^ (-2) .* (2 .* exp(1) .^ ((-1) .* he .* u0 + (-1) .* d .* u1) .* h .^  ...
          (-1) .* k0 .^ 2 .* R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .*  ...
          R10v .* R12v) .^ (-1) .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x +  ...
          exp(1) .^ ((-1) .* d .* u1) .* (2 .* exp(1) .^ ((-1) .* he .* u0) .* h  ...
          .^ (-1) .* k0 .^ 2 .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x + 2  ...
          .* exp(1) .^ ((-1) .* he .* u0 + (-2) .* d .* u1) .* h .^ (-1) .* k0 .^  ...
          2 .* R10v .* R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* ...
           R12v) .^ (-1) .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x)) + exp( ...
          1) .^ ((d + pz) .* u2) .* u2 .* ((1 + (-1) .* exp(1) .^ ((-2) .* d .*  ...
          u1) .* R10h .* R12h) .^ (-1) .* (u1 + u2) .^ (-1) .* (2 .* exp(1) .^ (( ...
          -1) .* he .* u0 + (-1) .* d .* u1) .* h .^ (-1) .* k0 .^ 2 .* R12v .* ( ...
          1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (k1  ...
          .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* (1 + R10v + exp(1) .^ ((-2) .* d  ...
          .* u1) .* N10 .* R12h .* T10h .* (u1 + u2)) .* x + exp(1) .^ ((-1) .*  ...
          he .* u0 + (-1) .* d .* u1) .* h .^ (-1) .* u0 .^ (-1) .* (2 .* k0 .^ 2  ...
          .* u0 .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) + ((-1) .* k0 .^ 2 +  ...
          k1 .^ 2) .* R12h .* T01h .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* ( ...
          u1 + u2)) .* x + (-1) .* k1 .^ 2 .* k2 .^ (-2) .* (2 .* exp(1) .^ ((-1)  ...
          .* he .* u0 + (-1) .* d .* u1) .* h .^ (-1) .* k0 .^ 2 .* R12v .* (1 + ( ...
          -1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (k1 .^ 2  ...
          .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x + exp(1) .^ ((-1) .* d .* u1) .* (2  ...
          .* exp(1) .^ ((-1) .* he .* u0) .* h .^ (-1) .* k0 .^ 2 .* (k1 .^ 2 .*  ...
          u0 + k0 .^ 2 .* u1) .^ (-1) .* x + 2 .* exp(1) .^ ((-1) .* he .* u0 + ( ...
          -2) .* d .* u1) .* h .^ (-1) .* k0 .^ 2 .* R10v .* R12v .* (1 + (-1) .*  ...
          exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (k1 .^ 2 .* u0 + ...
           k0 .^ 2 .* u1) .^ (-1) .* x))) + exp(1) .^ ((-1) .* d .* u1) .* (N10 .* ...
           (exp(1) .^ ((-1) .* he .* u0) .* h .^ (-1) .* T01h .* u0 .^ (-1) .* x + ...
           2 .* exp(1) .^ ((-1) .* he .* u0 + (-2) .* d .* u1) .* h .^ (-1) .* k0  ...
          .^ 2 .* R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .*  ...
          R12v) .^ (-1) .* T10h .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x) + ...
           R10h .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10h .* R12h) .^ ( ...
          -1) .* (u1 + u2) .^ (-1) .* (2 .* exp(1) .^ ((-1) .* he .* u0 + (-2) .*  ...
          d .* u1) .* h .^ (-1) .* k0 .^ 2 .* R12v .* (1 + (-1) .* exp(1) .^ ((-2) ...
           .* d .* u1) .* R10v .* R12v) .^ (-1) .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) ...
           .^ (-1) .* (1 + R10v + exp(1) .^ ((-2) .* d .* u1) .* N10 .* R12h .*  ...
          T10h .* (u1 + u2)) .* x + exp(1) .^ ((-1) .* he .* u0 + (-2) .* d .* u1) ...
           .* h .^ (-1) .* u0 .^ (-1) .* (2 .* k0 .^ 2 .* u0 .* (k1 .^ 2 .* u0 +  ...
          k0 .^ 2 .* u1) .^ (-1) + ((-1) .* k0 .^ 2 + k1 .^ 2) .* R12h .* T01h .*  ...
          (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* (u1 + u2)) .* x + (-1) .*  ...
          exp(1) .^ ((-1) .* d .* u1) .* k1 .^ 2 .* k2 .^ (-2) .* (2 .* exp(1) .^  ...
          ((-1) .* he .* u0 + (-1) .* d .* u1) .* h .^ (-1) .* k0 .^ 2 .* R12v .*  ...
          (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* ( ...
          k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x + exp(1) .^ ((-1) .* d .*  ...
          u1) .* (2 .* exp(1) .^ ((-1) .* he .* u0) .* h .^ (-1) .* k0 .^ 2 .* ( ...
          k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x + 2 .* exp(1) .^ ((-1) .*  ...
          he .* u0 + (-2) .* d .* u1) .* h .^ (-1) .* k0 .^ 2 .* R10v .* R12v .* ( ...
          1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (k1  ...
          .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x))))));
        else %Hz
            Hint = h .* J1 .* py .* rho .^ (-1) .* x .* ((-1) .* exp(1) .^ ((d + pz) .* u2) ...
       .* k1 .^ 2 .* k2 .^ (-2) .* u2 .* (2 .* exp(1) .^ ((-1) .* he .* u0 + ( ...
      -1) .* d .* u1) .* h .^ (-1) .* k0 .^ 2 .* R12v .* (1 + (-1) .* exp(1)  ...
      .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (k1 .^ 2 .* u0 + k0 .^  ...
      2 .* u1) .^ (-1) .* x + exp(1) .^ ((-1) .* d .* u1) .* (2 .* exp(1) .^ ( ...
      (-1) .* he .* u0) .* h .^ (-1) .* k0 .^ 2 .* (k1 .^ 2 .* u0 + k0 .^ 2 .* ...
       u1) .^ (-1) .* x + 2 .* exp(1) .^ ((-1) .* he .* u0 + (-2) .* d .* u1)  ...
      .* h .^ (-1) .* k0 .^ 2 .* R10v .* R12v .* (1 + (-1) .* exp(1) .^ ((-2)  ...
      .* d .* u1) .* R10v .* R12v) .^ (-1) .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1)  ...
      .^ (-1) .* x)) + (-1) .* exp(1) .^ ((d + pz) .* u2) .* h .^ (-2) .* x  ...
      .^ 2 .* ((1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10h .* R12h) .^ ( ...
      -1) .* (u1 + u2) .^ (-1) .* (2 .* exp(1) .^ ((-1) .* he .* u0 + (-1) .*  ...
      d .* u1) .* h .^ (-1) .* k0 .^ 2 .* R12v .* (1 + (-1) .* exp(1) .^ ((-2) ...
       .* d .* u1) .* R10v .* R12v) .^ (-1) .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) ...
       .^ (-1) .* (1 + R10v + exp(1) .^ ((-2) .* d .* u1) .* N10 .* R12h .*  ...
      T10h .* (u1 + u2)) .* x + exp(1) .^ ((-1) .* he .* u0 + (-1) .* d .* u1) ...
       .* h .^ (-1) .* u0 .^ (-1) .* (2 .* k0 .^ 2 .* u0 .* (k1 .^ 2 .* u0 +  ...
      k0 .^ 2 .* u1) .^ (-1) + ((-1) .* k0 .^ 2 + k1 .^ 2) .* R12h .* T01h .*  ...
      (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* (u1 + u2)) .* x + (-1) .* k1  ...
      .^ 2 .* k2 .^ (-2) .* (2 .* exp(1) .^ ((-1) .* he .* u0 + (-1) .* d .*  ...
      u1) .* h .^ (-1) .* k0 .^ 2 .* R12v .* (1 + (-1) .* exp(1) .^ ((-2) .*  ...
      d .* u1) .* R10v .* R12v) .^ (-1) .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^  ...
      (-1) .* x + exp(1) .^ ((-1) .* d .* u1) .* (2 .* exp(1) .^ ((-1) .* he  ...
      .* u0) .* h .^ (-1) .* k0 .^ 2 .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ ( ...
      -1) .* x + 2 .* exp(1) .^ ((-1) .* he .* u0 + (-2) .* d .* u1) .* h .^ ( ...
      -1) .* k0 .^ 2 .* R10v .* R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .*  ...
      u1) .* R10v .* R12v) .^ (-1) .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1)  ...
      .* x))) + exp(1) .^ ((-1) .* d .* u1) .* (N10 .* (exp(1) .^ ((-1) .* he  ...
      .* u0) .* h .^ (-1) .* T01h .* u0 .^ (-1) .* x + 2 .* exp(1) .^ ((-1) .* ...
       he .* u0 + (-2) .* d .* u1) .* h .^ (-1) .* k0 .^ 2 .* R12v .* (1 + ( ...
      -1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* T10h .* ( ...
      k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* x) + R10h .* (1 + (-1) .* exp( ...
      1) .^ ((-2) .* d .* u1) .* R10h .* R12h) .^ (-1) .* (u1 + u2) .^ (-1) .* ...
       (2 .* exp(1) .^ ((-1) .* he .* u0 + (-2) .* d .* u1) .* h .^ (-1) .*  ...
      k0 .^ 2 .* R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .*  ...
      R12v) .^ (-1) .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* (1 + R10v +  ...
      exp(1) .^ ((-2) .* d .* u1) .* N10 .* R12h .* T10h .* (u1 + u2)) .* x +  ...
      exp(1) .^ ((-1) .* he .* u0 + (-2) .* d .* u1) .* h .^ (-1) .* u0 .^ ( ...
      -1) .* (2 .* k0 .^ 2 .* u0 .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) +  ...
      ((-1) .* k0 .^ 2 + k1 .^ 2) .* R12h .* T01h .* (k1 .^ 2 .* u0 + k0 .^ 2  ...
      .* u1) .^ (-1) .* (u1 + u2)) .* x + (-1) .* exp(1) .^ ((-1) .* d .* u1)  ...
      .* k1 .^ 2 .* k2 .^ (-2) .* (2 .* exp(1) .^ ((-1) .* he .* u0 + (-1) .*  ...
      d .* u1) .* h .^ (-1) .* k0 .^ 2 .* R12v .* (1 + (-1) .* exp(1) .^ ((-2) ...
       .* d .* u1) .* R10v .* R12v) .^ (-1) .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) ...
       .^ (-1) .* x + exp(1) .^ ((-1) .* d .* u1) .* (2 .* exp(1) .^ ((-1) .*  ...
      he .* u0) .* h .^ (-1) .* k0 .^ 2 .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^  ...
      (-1) .* x + 2 .* exp(1) .^ ((-1) .* he .* u0 + (-2) .* d .* u1) .* h .^  ...
      (-1) .* k0 .^ 2 .* R10v .* R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .*  ...
      u1) .* R10v .* R12v) .^ (-1) .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1)  ...
      .* x))))));
        end
    end
               
elseif emitter == 1 %Source med1 or med1-med2 interface
        
    if medium == 0 %Air or air-med1 interface
        if component == 0; %Hx
            Hint = exp(1) .^ ((-1) .* pz .* u0) .* h .* px .* py .* rho .^ (-2) .* x .* (( ...
              -2) .* J1 .* rho .^ (-1) + h .^ (-1) .* J0 .* x) .* ((-1) .* k0 .^ (-2)  ...
              .* k1 .^ 2 .* T10v .* (exp(1) .^ (he .* u1) .* h .^ (-1) .* u1 .^ (-1)  ...
              .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) ...
               .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* (d + he) .* u1) .* h  ...
              .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .* d + he) .* u1) .* h .^  ...
              (-1) .* R10v .* u1 .^ (-1) .* x)) + u0 .* (N10 .* T10h .* (exp(1) .^ ( ...
              he .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1)  ...
              .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d  ...
              .* u1 + (-1) .* (d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) ...
               .^ (((-2) .* d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x)) + ...
               (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10h .* R12h) .^ (-1) .* ( ...
              u1 + u2) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* (d + he) .*  ...
              u1) .* h .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^ (( ...
              -2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1  ...
              + (-1) .* (d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (( ...
              (-2) .* d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x) + exp(1) ...
               .^ ((-2) .* d .* u1) .* (R10v + N10 .* R12h .* T10h .* (u1 + u2)) .* ( ...
              exp(1) .^ (he .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) ...
               .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ ( ...
              (-1) .* d .* u1 + (-1) .* (d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .*  ...
              x + exp(1) .^ (((-2) .* d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ ( ...
              -1) .* x)) + (-1) .* exp(1) .^ ((-1) .* d .* u1) .* k1 .^ 2 .* k2 .^ ( ...
              -2) .* (exp(1) .^ (((-1) .* d + (-1) .* he) .* u1) .* h .^ (-1) .* u1  ...
              .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v  ...
              .* R12v) .^ (-1) .* (exp(1) .^ (((-1) .* d + (-1) .* he) .* u1) .* h .^  ...
              (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-1) .* d + he) .* u1) .* h .^ ( ...
              -1) .* R10v .* u1 .^ (-1) .* x) + exp(1) .^ ((-1) .* d .* u1) .* R10v .* ...
               (exp(1) .^ (he .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + ( ...
              -1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1)  ...
              .^ ((-1) .* d .* u1 + (-1) .* (d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) ...
               .* x + exp(1) .^ (((-2) .* d + he) .* u1) .* h .^ (-1) .* R10v .* u1  ...
              .^ (-1) .* x)))) + R10h .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .*  ...
              R10h .* R12h) .^ (-1) .* (u1 + u2) .^ (-1) .* (exp(1) .^ ((-1) .* d .*  ...
              u1 + (-1) .* (d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + R12v .* ( ...
              1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* ( ...
              exp(1) .^ ((-1) .* d .* u1 + (-1) .* (d + he) .* u1) .* h .^ (-1) .* u1  ...
              .^ (-1) .* x + exp(1) .^ (((-2) .* d + he) .* u1) .* h .^ (-1) .* R10v  ...
              .* u1 .^ (-1) .* x) + exp(1) .^ ((-2) .* d .* u1) .* (R10v + N10 .*  ...
              R12h .* T10h .* (u1 + u2)) .* (exp(1) .^ (he .* u1) .* h .^ (-1) .* u1  ...
              .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v  ...
              .* R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* (d + he) .*  ...
              u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .* d + he) .* u1) ...
               .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x)) + (-1) .* exp(1) .^ ((-1) .*  ...
              d .* u1) .* k1 .^ 2 .* k2 .^ (-2) .* (exp(1) .^ (((-1) .* d + (-1) .*  ...
              he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) ...
               .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ (((-1) .*  ...
              d + (-1) .* he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ ((( ...
              -1) .* d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x) + exp(1)  ...
              .^ ((-1) .* d .* u1) .* R10v .* (exp(1) .^ (he .* u1) .* h .^ (-1) .*  ...
              u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .*  ...
              R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* (d + he)  ...
              .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .* d + he) .*  ...
              u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x))))));

        elseif component ==1 %Hy
            Hint = exp(1) .^ ((-1) .* pz .* u0) .* h .^ 2 .* J0 .* k1 .^ 2 .* T10v .* (exp( ...
          1) .^ (he .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .*  ...
          exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) ...
           .* d .* u1 + (-1) .* (d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x +  ...
          exp(1) .^ (((-2) .* d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* ...
           x)) + exp(1) .^ ((-1) .* pz .* u0) .* h .* x .* (J1 .* ((-2) .* py .^  ...
          2 .* rho .^ (-3) + rho .^ (-1)) + h .^ (-1) .* J0 .* py .^ 2 .* rho .^ ( ...
          -2) .* x) .* ((-1) .* k0 .^ (-2) .* k1 .^ 2 .* T10v .* (exp(1) .^ (he .* ...
           u1) .* h .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^ (( ...
          -2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1  ...
          + (-1) .* (d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (( ...
          (-2) .* d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x)) + u0 .* ...
           (N10 .* T10h .* (exp(1) .^ (he .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + ...
           R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ ( ...
          -1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* (d + he) .* u1) .* h .^ ( ...
          -1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .* d + he) .* u1) .* h .^ (-1) ...
           .* R10v .* u1 .^ (-1) .* x)) + (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) ...
           .* R10h .* R12h) .^ (-1) .* (u1 + u2) .^ (-1) .* (exp(1) .^ ((-1) .* d  ...
          .* u1 + (-1) .* (d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + R12v  ...
          .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .*  ...
          (exp(1) .^ ((-1) .* d .* u1 + (-1) .* (d + he) .* u1) .* h .^ (-1) .*  ...
          u1 .^ (-1) .* x + exp(1) .^ (((-2) .* d + he) .* u1) .* h .^ (-1) .*  ...
          R10v .* u1 .^ (-1) .* x) + exp(1) .^ ((-2) .* d .* u1) .* (R10v + N10 .* ...
           R12h .* T10h .* (u1 + u2)) .* (exp(1) .^ (he .* u1) .* h .^ (-1) .* u1  ...
          .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v  ...
          .* R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* (d + he) .*  ...
          u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .* d + he) .* u1) ...
           .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x)) + (-1) .* exp(1) .^ ((-1) .*  ...
          d .* u1) .* k1 .^ 2 .* k2 .^ (-2) .* (exp(1) .^ (((-1) .* d + (-1) .*  ...
          he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) ...
           .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ (((-1) .*  ...
          d + (-1) .* he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ ((( ...
          -1) .* d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x) + exp(1)  ...
          .^ ((-1) .* d .* u1) .* R10v .* (exp(1) .^ (he .* u1) .* h .^ (-1) .*  ...
          u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .*  ...
          R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* (d + he)  ...
          .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .* d + he) .*  ...
          u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x)))) + R10h .* (1 + (-1) .*  ...
          exp(1) .^ ((-2) .* d .* u1) .* R10h .* R12h) .^ (-1) .* (u1 + u2) .^ ( ...
          -1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* (d + he) .* u1) .* h .^ ( ...
          -1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .*  ...
          u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* ( ...
          d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .* d + ...
           he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x) + exp(1) .^ ((-2)  ...
          .* d .* u1) .* (R10v + N10 .* R12h .* T10h .* (u1 + u2)) .* (exp(1) .^ ( ...
          he .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1)  ...
          .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d  ...
          .* u1 + (-1) .* (d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) ...
           .^ (((-2) .* d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x)) + ...
           (-1) .* exp(1) .^ ((-1) .* d .* u1) .* k1 .^ 2 .* k2 .^ (-2) .* (exp(1) ...
           .^ (((-1) .* d + (-1) .* he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x +  ...
          R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ ( ...
          -1) .* (exp(1) .^ (((-1) .* d + (-1) .* he) .* u1) .* h .^ (-1) .* u1  ...
          .^ (-1) .* x + exp(1) .^ (((-1) .* d + he) .* u1) .* h .^ (-1) .* R10v  ...
          .* u1 .^ (-1) .* x) + exp(1) .^ ((-1) .* d .* u1) .* R10v .* (exp(1) .^  ...
          (he .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) ...
           .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d  ...
          .* u1 + (-1) .* (d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) ...
           .^ (((-2) .* d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x)))) ...
          ));   
        else %Hz
            Hint =  exp(1) .^ ((-1) .* pz .* u0) .* h .* J1 .* py .* rho .^ (-1) .* x .* ( ...
          k0 .^ (-2) .* k1 .^ 2 .* T10v .* u0 .* (exp(1) .^ (he .* u1) .* h .^ ( ...
          -1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .*  ...
          u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* ( ...
          d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .* d + ...
           he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x)) + (-1) .* h .^ ( ...
          -2) .* x .^ 2 .* (N10 .* T10h .* (exp(1) .^ (he .* u1) .* h .^ (-1) .*  ...
          u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .*  ...
          R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* (d + he)  ...
          .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .* d + he) .*  ...
          u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x)) + (1 + (-1) .* exp(1) .^ ( ...
          (-2) .* d .* u1) .* R10h .* R12h) .^ (-1) .* (u1 + u2) .^ (-1) .* (exp( ...
          1) .^ ((-1) .* d .* u1 + (-1) .* (d + he) .* u1) .* h .^ (-1) .* u1 .^ ( ...
          -1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .*  ...
          R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* (d + he) .* u1)  ...
          .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .* d + he) .* u1) .*  ...
          h .^ (-1) .* R10v .* u1 .^ (-1) .* x) + exp(1) .^ ((-2) .* d .* u1) .* ( ...
          R10v + N10 .* R12h .* T10h .* (u1 + u2)) .* (exp(1) .^ (he .* u1) .* h  ...
          .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d  ...
          .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* ...
           (d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .*  ...
          d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x)) + (-1) .* exp( ...
          1) .^ ((-1) .* d .* u1) .* k1 .^ 2 .* k2 .^ (-2) .* (exp(1) .^ (((-1) .* ...
           d + (-1) .* he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + ( ...
          -1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1)  ...
          .^ (((-1) .* d + (-1) .* he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x +  ...
          exp(1) .^ (((-1) .* d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* ...
           x) + exp(1) .^ ((-1) .* d .* u1) .* R10v .* (exp(1) .^ (he .* u1) .* h  ...
          .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d  ...
          .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* ...
           (d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .*  ...
          d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x)))) + R10h .* (1  ...
          + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10h .* R12h) .^ (-1) .* (u1 +  ...
          u2) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* (d + he) .* u1) .*  ...
          h .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .*  ...
          d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1)  ...
          .* (d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .* ...
           d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x) + exp(1) .^ (( ...
          -2) .* d .* u1) .* (R10v + N10 .* R12h .* T10h .* (u1 + u2)) .* (exp(1)  ...
          .^ (he .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .*  ...
          exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) ...
           .* d .* u1 + (-1) .* (d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x +  ...
          exp(1) .^ (((-2) .* d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* ...
           x)) + (-1) .* exp(1) .^ ((-1) .* d .* u1) .* k1 .^ 2 .* k2 .^ (-2) .* ( ...
          exp(1) .^ (((-1) .* d + (-1) .* he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* ...
           x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v)  ...
          .^ (-1) .* (exp(1) .^ (((-1) .* d + (-1) .* he) .* u1) .* h .^ (-1) .*  ...
          u1 .^ (-1) .* x + exp(1) .^ (((-1) .* d + he) .* u1) .* h .^ (-1) .*  ...
          R10v .* u1 .^ (-1) .* x) + exp(1) .^ ((-1) .* d .* u1) .* R10v .* (exp( ...
          1) .^ (he .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .*  ...
          exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) ...
           .* d .* u1 + (-1) .* (d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x +  ...
          exp(1) .^ (((-2) .* d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* ...
           x))))));

        end

    elseif medium == 1 %med1 or med1-med2 interface
        if component == 0;     %Hx
            Hint = h .* px .* py .* rho .^ (-2) .* x .* ((-2) .* J1 .* rho .^ (-1) + h .^ ( ...
          -1) .* J0 .* x) .* ((-1) .* R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* ...
           u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ (((-2) .* d + (-1) .* he + ( ...
          -1) .* pz) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .*  ...
          d + he + (-1) .* pz) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x) + ( ...
          -1) .* exp(1) .^ (pz .* u1) .* R10v .* (exp(1) .^ (he .* u1) .* h .^ ( ...
          -1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .*  ...
          u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ (((-2) .* d + (-1) .* he) .*  ...
          u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .* d + he) .* u1) ...
           .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x)) + (-1) .* u1 .* ((-1) .* (1 + ...
           (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10h .* R12h) .^ (-1) .* (u1 +  ...
          u2) .^ (-1) .* (exp(1) .^ (((-2) .* d + (-1) .* he + (-1) .* pz) .* u1)  ...
          .* h .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2)  ...
          .* d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ (((-2) .* d + (-1) .* ...
           he + (-1) .* pz) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ ((( ...
          -2) .* d + he + (-1) .* pz) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* ...
           x) + exp(1) .^ (((-2) .* d + (-1) .* pz) .* u1) .* (R10v + N10 .* R12h  ...
          .* T10h .* (u1 + u2)) .* (exp(1) .^ (he .* u1) .* h .^ (-1) .* u1 .^ ( ...
          -1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .*  ...
          R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* (d + he) .* u1)  ...
          .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .* d + he) .* u1) .*  ...
          h .^ (-1) .* R10v .* u1 .^ (-1) .* x)) + (-1) .* exp(1) .^ (((-1) .* d + ...
           (-1) .* pz) .* u1) .* k1 .^ 2 .* k2 .^ (-2) .* (exp(1) .^ (((-1) .* d + ...
           (-1) .* he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1)  ...
          .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ (( ...
          (-1) .* d + (-1) .* he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1)  ...
          .^ (((-1) .* d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x) +  ...
          exp(1) .^ ((-1) .* d .* u1) .* R10v .* (exp(1) .^ (he .* u1) .* h .^ ( ...
          -1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .*  ...
          u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* ( ...
          d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .* d + ...
           he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x)))) + exp(1) .^ (pz  ...
          .* u1) .* (N10 .* T10h .* (exp(1) .^ (he .* u1) .* h .^ (-1) .* u1 .^ ( ...
          -1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .*  ...
          R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* (d + he) .* u1)  ...
          .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .* d + he) .* u1) .*  ...
          h .^ (-1) .* R10v .* u1 .^ (-1) .* x)) + R10h .* (1 + (-1) .* exp(1) .^  ...
          ((-2) .* d .* u1) .* R10h .* R12h) .^ (-1) .* (u1 + u2) .^ (-1) .* (exp( ...
          1) .^ ((-1) .* d .* u1 + (-1) .* (d + he) .* u1) .* h .^ (-1) .* u1 .^ ( ...
          -1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .*  ...
          R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* (d + he) .* u1)  ...
          .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .* d + he) .* u1) .*  ...
          h .^ (-1) .* R10v .* u1 .^ (-1) .* x) + exp(1) .^ ((-2) .* d .* u1) .* ( ...
          R10v + N10 .* R12h .* T10h .* (u1 + u2)) .* (exp(1) .^ (he .* u1) .* h  ...
          .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d  ...
          .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* ...
           (d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .*  ...
          d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x)) + (-1) .* exp( ...
          1) .^ ((-1) .* d .* u1) .* k1 .^ 2 .* k2 .^ (-2) .* (exp(1) .^ (((-1) .* ...
           d + (-1) .* he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + ( ...
          -1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1)  ...
          .^ (((-1) .* d + (-1) .* he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x +  ...
          exp(1) .^ (((-1) .* d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* ...
           x) + exp(1) .^ ((-1) .* d .* u1) .* R10v .* (exp(1) .^ (he .* u1) .* h  ...
          .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d  ...
          .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* ...
           (d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .*  ...
          d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x)))))));
        elseif component == 1; %Hy
            Hint = h .^ 2 .* J0 .* k1 .^ 2 .* (R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* ...
           u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ (((-2) .* d + (-1) .* he + ( ...
          -1) .* pz) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .*  ...
          d + he + (-1) .* pz) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x) +  ...
          exp(1) .^ (pz .* u1) .* R10v .* (exp(1) .^ (he .* u1) .* h .^ (-1) .*  ...
          u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .*  ...
          R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* (d + he)  ...
          .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .* d + he) .*  ...
          u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x))) + (-1) .* h .* x .* (J1  ...
          .* ((-2) .* py .^ 2 .* rho .^ (-3) + rho .^ (-1)) + h .^ (-1) .* J0 .*  ...
          py .^ 2 .* rho .^ (-2) .* x) .* (R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* ...
           d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ (((-2) .* d + (-1) .*  ...
          he + (-1) .* pz) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ ((( ...
          -2) .* d + he + (-1) .* pz) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* ...
           x) + exp(1) .^ (pz .* u1) .* R10v .* (exp(1) .^ (he .* u1) .* h .^ (-1) ...
           .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1)  ...
          .* R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* (d +  ...
          he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .* d + he) ...
           .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x)) + u1 .* ((-1) .* (1 +  ...
          (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10h .* R12h) .^ (-1) .* (u1 +  ...
          u2) .^ (-1) .* (exp(1) .^ (((-2) .* d + (-1) .* he + (-1) .* pz) .* u1)  ...
          .* h .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2)  ...
          .* d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ (((-2) .* d + (-1) .* ...
           he + (-1) .* pz) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ ((( ...
          -2) .* d + he + (-1) .* pz) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* ...
           x) + exp(1) .^ (((-2) .* d + (-1) .* pz) .* u1) .* (R10v + N10 .* R12h  ...
          .* T10h .* (u1 + u2)) .* (exp(1) .^ (he .* u1) .* h .^ (-1) .* u1 .^ ( ...
          -1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .*  ...
          R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* (d + he) .* u1)  ...
          .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .* d + he) .* u1) .*  ...
          h .^ (-1) .* R10v .* u1 .^ (-1) .* x)) + (-1) .* exp(1) .^ (((-1) .* d + ...
           (-1) .* pz) .* u1) .* k1 .^ 2 .* k2 .^ (-2) .* (exp(1) .^ (((-1) .* d + ...
           (-1) .* he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1)  ...
          .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ (( ...
          (-1) .* d + (-1) .* he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1)  ...
          .^ (((-1) .* d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x) +  ...
          exp(1) .^ ((-1) .* d .* u1) .* R10v .* (exp(1) .^ (he .* u1) .* h .^ ( ...
          -1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .*  ...
          u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* ( ...
          d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .* d + ...
           he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x)))) + exp(1) .^ (pz  ...
          .* u1) .* (N10 .* T10h .* (exp(1) .^ (he .* u1) .* h .^ (-1) .* u1 .^ ( ...
          -1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .*  ...
          R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* (d + he) .* u1)  ...
          .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .* d + he) .* u1) .*  ...
          h .^ (-1) .* R10v .* u1 .^ (-1) .* x)) + R10h .* (1 + (-1) .* exp(1) .^  ...
          ((-2) .* d .* u1) .* R10h .* R12h) .^ (-1) .* (u1 + u2) .^ (-1) .* (exp( ...
          1) .^ ((-1) .* d .* u1 + (-1) .* (d + he) .* u1) .* h .^ (-1) .* u1 .^ ( ...
          -1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .*  ...
          R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* (d + he) .* u1)  ...
          .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .* d + he) .* u1) .*  ...
          h .^ (-1) .* R10v .* u1 .^ (-1) .* x) + exp(1) .^ ((-2) .* d .* u1) .* ( ...
          R10v + N10 .* R12h .* T10h .* (u1 + u2)) .* (exp(1) .^ (he .* u1) .* h  ...
          .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d  ...
          .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* ...
           (d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .*  ...
          d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x)) + (-1) .* exp( ...
          1) .^ ((-1) .* d .* u1) .* k1 .^ 2 .* k2 .^ (-2) .* (exp(1) .^ (((-1) .* ...
           d + (-1) .* he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + ( ...
          -1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1)  ...
          .^ (((-1) .* d + (-1) .* he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x +  ...
          exp(1) .^ (((-1) .* d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* ...
           x) + exp(1) .^ ((-1) .* d .* u1) .* R10v .* (exp(1) .^ (he .* u1) .* h  ...
          .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d  ...
          .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* ...
           (d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .*  ...
          d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x)))))));
        else                    %Hz
            Hint = h .* J1 .* py .* rho .^ (-1) .* x .* ((-1) .* u1 .* ((-1) .* R12v .* (1  ...
          + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (exp( ...
          1) .^ (((-2) .* d + (-1) .* he + (-1) .* pz) .* u1) .* h .^ (-1) .* u1  ...
          .^ (-1) .* x + exp(1) .^ (((-2) .* d + he + (-1) .* pz) .* u1) .* h .^ ( ...
          -1) .* R10v .* u1 .^ (-1) .* x) + exp(1) .^ (pz .* u1) .* R10v .* (exp( ...
          1) .^ (he .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .*  ...
          exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) ...
           .* d .* u1 + (-1) .* (d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x +  ...
          exp(1) .^ (((-2) .* d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* ...
           x))) + (-1) .* h .^ (-2) .* x .^ 2 .* ((1 + (-1) .* exp(1) .^ ((-2) .*  ...
          d .* u1) .* R10h .* R12h) .^ (-1) .* (u1 + u2) .^ (-1) .* (exp(1) .^ ((( ...
          -2) .* d + (-1) .* he + (-1) .* pz) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* ...
           x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v)  ...
          .^ (-1) .* (exp(1) .^ (((-2) .* d + (-1) .* he + (-1) .* pz) .* u1) .*  ...
          h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .* d + he + (-1) .* pz)  ...
          .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x) + exp(1) .^ (((-2) .* d  ...
          + (-1) .* pz) .* u1) .* (R10v + N10 .* R12h .* T10h .* (u1 + u2)) .* ( ...
          exp(1) .^ (he .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) ...
           .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ ( ...
          (-1) .* d .* u1 + (-1) .* (d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .*  ...
          x + exp(1) .^ (((-2) .* d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ ( ...
          -1) .* x)) + (-1) .* exp(1) .^ (((-1) .* d + (-1) .* pz) .* u1) .* k1  ...
          .^ 2 .* k2 .^ (-2) .* (exp(1) .^ (((-1) .* d + (-1) .* he) .* u1) .* h  ...
          .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d  ...
          .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ (((-1) .* d + (-1) .* he)  ...
          .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-1) .* d + he) .*  ...
          u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x) + exp(1) .^ ((-1) .* d .*  ...
          u1) .* R10v .* (exp(1) .^ (he .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x +  ...
          R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ ( ...
          -1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* (d + he) .* u1) .* h .^ ( ...
          -1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .* d + he) .* u1) .* h .^ (-1) ...
           .* R10v .* u1 .^ (-1) .* x)))) + exp(1) .^ (pz .* u1) .* (N10 .* T10h  ...
          .* (exp(1) .^ (he .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 +  ...
          (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1)  ...
          .^ ((-1) .* d .* u1 + (-1) .* (d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) ...
           .* x + exp(1) .^ (((-2) .* d + he) .* u1) .* h .^ (-1) .* R10v .* u1  ...
          .^ (-1) .* x)) + R10h .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .*  ...
          R10h .* R12h) .^ (-1) .* (u1 + u2) .^ (-1) .* (exp(1) .^ ((-1) .* d .*  ...
          u1 + (-1) .* (d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + R12v .* ( ...
          1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* ( ...
          exp(1) .^ ((-1) .* d .* u1 + (-1) .* (d + he) .* u1) .* h .^ (-1) .* u1  ...
          .^ (-1) .* x + exp(1) .^ (((-2) .* d + he) .* u1) .* h .^ (-1) .* R10v  ...
          .* u1 .^ (-1) .* x) + exp(1) .^ ((-2) .* d .* u1) .* (R10v + N10 .*  ...
          R12h .* T10h .* (u1 + u2)) .* (exp(1) .^ (he .* u1) .* h .^ (-1) .* u1  ...
          .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v  ...
          .* R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* (d + he) .*  ...
          u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .* d + he) .* u1) ...
           .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x)) + (-1) .* exp(1) .^ ((-1) .*  ...
          d .* u1) .* k1 .^ 2 .* k2 .^ (-2) .* (exp(1) .^ (((-1) .* d + (-1) .*  ...
          he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) ...
           .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ (((-1) .*  ...
          d + (-1) .* he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ ((( ...
          -1) .* d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x) + exp(1)  ...
          .^ ((-1) .* d .* u1) .* R10v .* (exp(1) .^ (he .* u1) .* h .^ (-1) .*  ...
          u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .*  ...
          R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* (d + he)  ...
          .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .* d + he) .*  ...
          u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x)))))));

        end
    else %Med2
        if component == 0; %Hx
            Hint = h .* px .* py .* rho .^ (-2) .* x .* ((-2) .* J1 .* rho .^ (-1) + h .^ ( ...
          -1) .* J0 .* x) .* ((-1) .* exp(1) .^ ((d + pz) .* u2) .* k1 .^ 2 .* k2  ...
          .^ (-2) .* (exp(1) .^ (((-1) .* d + (-1) .* he) .* u1) .* h .^ (-1) .*  ...
          u1 .^ (-1) .* x + exp(1) .^ (d .* u1) .* R12v .* (1 + (-1) .* exp(1) .^  ...
          ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .*  ...
          u1 + (-1) .* (d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1)  ...
          .^ (((-2) .* d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x) +  ...
          exp(1) .^ ((-1) .* d .* u1) .* R10v .* (exp(1) .^ (he .* u1) .* h .^ ( ...
          -1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .*  ...
          u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* ( ...
          d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .* d + ...
           he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x))) + (-1) .* exp(1)  ...
          .^ ((d + pz) .* u2) .* u2 .* ((1 + (-1) .* exp(1) .^ ((-2) .* d .* u1)  ...
          .* R10h .* R12h) .^ (-1) .* (u1 + u2) .^ (-1) .* (exp(1) .^ (((-1) .* d  ...
          + (-1) .* he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) ...
           .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ ( ...
          ((-1) .* d + (-1) .* he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) ...
           .^ (((-1) .* d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x) +  ...
          exp(1) .^ ((-1) .* d .* u1) .* (R10v + N10 .* R12h .* T10h .* (u1 + u2)) ...
           .* (exp(1) .^ (he .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + ...
           (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) ...
           .^ ((-1) .* d .* u1 + (-1) .* (d + he) .* u1) .* h .^ (-1) .* u1 .^ ( ...
          -1) .* x + exp(1) .^ (((-2) .* d + he) .* u1) .* h .^ (-1) .* R10v .*  ...
          u1 .^ (-1) .* x)) + (-1) .* k1 .^ 2 .* k2 .^ (-2) .* (exp(1) .^ (((-1)  ...
          .* d + (-1) .* he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + ...
           (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) ...
           .^ (((-1) .* d + (-1) .* he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x +  ...
          exp(1) .^ (((-1) .* d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* ...
           x) + exp(1) .^ ((-1) .* d .* u1) .* R10v .* (exp(1) .^ (he .* u1) .* h  ...
          .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d  ...
          .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* ...
           (d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .*  ...
          d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x)))) + exp(1) .^ ( ...
          (-1) .* d .* u1) .* (N10 .* T10h .* (exp(1) .^ (he .* u1) .* h .^ (-1)  ...
          .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* ...
           R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* (d + he) ...
           .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .* d + he) .* ...
           u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x)) + R10h .* (1 + (-1) .*  ...
          exp(1) .^ ((-2) .* d .* u1) .* R10h .* R12h) .^ (-1) .* (u1 + u2) .^ ( ...
          -1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* (d + he) .* u1) .* h .^ ( ...
          -1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .*  ...
          u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* ( ...
          d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .* d + ...
           he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x) + exp(1) .^ ((-2)  ...
          .* d .* u1) .* (R10v + N10 .* R12h .* T10h .* (u1 + u2)) .* (exp(1) .^ ( ...
          he .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1)  ...
          .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d  ...
          .* u1 + (-1) .* (d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) ...
           .^ (((-2) .* d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x)) + ...
           (-1) .* k1 .^ 2 .* k2 .^ (-2) .* (exp(1) .^ (((-2) .* d + (-1) .* he)  ...
          .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^  ...
          ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .*  ...
          u1 + (-1) .* (d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1)  ...
          .^ (((-2) .* d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x) +  ...
          exp(1) .^ ((-2) .* d .* u1) .* R10v .* (exp(1) .^ (he .* u1) .* h .^ ( ...
          -1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .*  ...
          u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* ( ...
          d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .* d + ...
           he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x)))))));

        elseif component ==1 %Hy
            Hint = exp(1) .^ ((d + pz) .* u2) .* h .^ 2 .* J0 .* k1 .^ 2 .* (exp(1) .^ ((( ...
          -1) .* d + (-1) .* he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + R12v .*  ...
          (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* ( ...
          exp(1) .^ (((-1) .* d + (-1) .* he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* ...
           x + exp(1) .^ (((-1) .* d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ ( ...
          -1) .* x) + exp(1) .^ ((-1) .* d .* u1) .* R10v .* (exp(1) .^ (he .* u1) ...
           .* h .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2)  ...
          .* d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + ( ...
          -1) .* (d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ ((( ...
          -2) .* d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x))) + (-1)  ...
          .* h .* x .* (J1 .* ((-2) .* py .^ 2 .* rho .^ (-3) + rho .^ (-1)) + h  ...
          .^ (-1) .* J0 .* py .^ 2 .* rho .^ (-2) .* x) .* (exp(1) .^ ((d + pz) .* ...
           u2) .* k1 .^ 2 .* k2 .^ (-2) .* (exp(1) .^ (((-1) .* d + (-1) .* he) .* ...
           u1) .* h .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^ (( ...
          -2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ (((-1) .* d + ( ...
          -1) .* he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-1) .*  ...
          d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x) + exp(1) .^ (( ...
          -1) .* d .* u1) .* R10v .* (exp(1) .^ (he .* u1) .* h .^ (-1) .* u1 .^ ( ...
          -1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .*  ...
          R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* (d + he) .* u1)  ...
          .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .* d + he) .* u1) .*  ...
          h .^ (-1) .* R10v .* u1 .^ (-1) .* x))) + exp(1) .^ ((d + pz) .* u2) .*  ...
          u2 .* ((1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10h .* R12h) .^ (-1) ...
           .* (u1 + u2) .^ (-1) .* (exp(1) .^ (((-1) .* d + (-1) .* he) .* u1) .*  ...
          h .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .*  ...
          d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ (((-1) .* d + (-1) .*  ...
          he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-1) .* d + he) ...
           .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x) + exp(1) .^ ((-1) .* d  ...
          .* u1) .* (R10v + N10 .* R12h .* T10h .* (u1 + u2)) .* (exp(1) .^ (he .* ...
           u1) .* h .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^ (( ...
          -2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1  ...
          + (-1) .* (d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (( ...
          (-2) .* d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x)) + (-1)  ...
          .* k1 .^ 2 .* k2 .^ (-2) .* (exp(1) .^ (((-1) .* d + (-1) .* he) .* u1)  ...
          .* h .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2)  ...
          .* d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ (((-1) .* d + (-1) .* ...
           he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-1) .* d +  ...
          he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x) + exp(1) .^ ((-1) .* ...
           d .* u1) .* R10v .* (exp(1) .^ (he .* u1) .* h .^ (-1) .* u1 .^ (-1) .* ...
           x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v)  ...
          .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* (d + he) .* u1) .* h  ...
          .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .* d + he) .* u1) .* h .^  ...
          (-1) .* R10v .* u1 .^ (-1) .* x)))) + exp(1) .^ ((-1) .* d .* u1) .* ( ...
          N10 .* T10h .* (exp(1) .^ (he .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x +  ...
          R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ ( ...
          -1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* (d + he) .* u1) .* h .^ ( ...
          -1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .* d + he) .* u1) .* h .^ (-1) ...
           .* R10v .* u1 .^ (-1) .* x)) + R10h .* (1 + (-1) .* exp(1) .^ ((-2) .*  ...
          d .* u1) .* R10h .* R12h) .^ (-1) .* (u1 + u2) .^ (-1) .* (exp(1) .^ (( ...
          -1) .* d .* u1 + (-1) .* (d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .*  ...
          x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v)  ...
          .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* (d + he) .* u1) .* h  ...
          .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .* d + he) .* u1) .* h .^  ...
          (-1) .* R10v .* u1 .^ (-1) .* x) + exp(1) .^ ((-2) .* d .* u1) .* (R10v  ...
          + N10 .* R12h .* T10h .* (u1 + u2)) .* (exp(1) .^ (he .* u1) .* h .^ ( ...
          -1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .*  ...
          u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* ( ...
          d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .* d + ...
           he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x)) + (-1) .* exp(1)  ...
          .^ ((-1) .* d .* u1) .* k1 .^ 2 .* k2 .^ (-2) .* (exp(1) .^ (((-1) .* d  ...
          + (-1) .* he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) ...
           .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ ( ...
          ((-1) .* d + (-1) .* he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) ...
           .^ (((-1) .* d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x) +  ...
          exp(1) .^ ((-1) .* d .* u1) .* R10v .* (exp(1) .^ (he .* u1) .* h .^ ( ...
          -1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .*  ...
          u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* ( ...
          d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .* d + ...
           he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x)))))));

        else %Hz
            Hint = h .* J1 .* py .* rho .^ (-1) .* x .* ((-1) .* exp(1) .^ ((d + pz) .* u2) ...
           .* k1 .^ 2 .* k2 .^ (-2) .* u2 .* (exp(1) .^ (((-1) .* d + (-1) .* he)  ...
          .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^  ...
          ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ (((-1) .* d + ( ...
          -1) .* he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-1) .*  ...
          d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x) + exp(1) .^ (( ...
          -1) .* d .* u1) .* R10v .* (exp(1) .^ (he .* u1) .* h .^ (-1) .* u1 .^ ( ...
          -1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .*  ...
          R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* (d + he) .* u1)  ...
          .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .* d + he) .* u1) .*  ...
          h .^ (-1) .* R10v .* u1 .^ (-1) .* x))) + (-1) .* exp(1) .^ ((d + pz) .* ...
           u2) .* h .^ (-2) .* x .^ 2 .* ((1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) ...
           .* R10h .* R12h) .^ (-1) .* (u1 + u2) .^ (-1) .* (exp(1) .^ (((-1) .*  ...
          d + (-1) .* he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + ( ...
          -1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1)  ...
          .^ (((-1) .* d + (-1) .* he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x +  ...
          exp(1) .^ (((-1) .* d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* ...
           x) + exp(1) .^ ((-1) .* d .* u1) .* (R10v + N10 .* R12h .* T10h .* (u1  ...
          + u2)) .* (exp(1) .^ (he .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + R12v  ...
          .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .*  ...
          (exp(1) .^ ((-1) .* d .* u1 + (-1) .* (d + he) .* u1) .* h .^ (-1) .*  ...
          u1 .^ (-1) .* x + exp(1) .^ (((-2) .* d + he) .* u1) .* h .^ (-1) .*  ...
          R10v .* u1 .^ (-1) .* x)) + (-1) .* k1 .^ 2 .* k2 .^ (-2) .* (exp(1) .^  ...
          (((-1) .* d + (-1) .* he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + R12v  ...
          .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .*  ...
          (exp(1) .^ (((-1) .* d + (-1) .* he) .* u1) .* h .^ (-1) .* u1 .^ (-1)  ...
          .* x + exp(1) .^ (((-1) .* d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^  ...
          (-1) .* x) + exp(1) .^ ((-1) .* d .* u1) .* R10v .* (exp(1) .^ (he .*  ...
          u1) .* h .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^ (( ...
          -2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1  ...
          + (-1) .* (d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (( ...
          (-2) .* d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x)))) +  ...
          exp(1) .^ ((-1) .* d .* u1) .* (N10 .* T10h .* (exp(1) .^ (he .* u1) .*  ...
          h .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .*  ...
          d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1)  ...
          .* (d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .* ...
           d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x)) + R10h .* (1 + ...
           (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10h .* R12h) .^ (-1) .* (u1 +  ...
          u2) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1) .* (d + he) .* u1) .*  ...
          h .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .*  ...
          d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) .* d .* u1 + (-1)  ...
          .* (d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + exp(1) .^ (((-2) .* ...
           d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* x) + exp(1) .^ (( ...
          -2) .* d .* u1) .* (R10v + N10 .* R12h .* T10h .* (u1 + u2)) .* (exp(1)  ...
          .^ (he .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .*  ...
          exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) ...
           .* d .* u1 + (-1) .* (d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x +  ...
          exp(1) .^ (((-2) .* d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* ...
           x)) + (-1) .* exp(1) .^ ((-1) .* d .* u1) .* k1 .^ 2 .* k2 .^ (-2) .* ( ...
          exp(1) .^ (((-1) .* d + (-1) .* he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* ...
           x + R12v .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v)  ...
          .^ (-1) .* (exp(1) .^ (((-1) .* d + (-1) .* he) .* u1) .* h .^ (-1) .*  ...
          u1 .^ (-1) .* x + exp(1) .^ (((-1) .* d + he) .* u1) .* h .^ (-1) .*  ...
          R10v .* u1 .^ (-1) .* x) + exp(1) .^ ((-1) .* d .* u1) .* R10v .* (exp( ...
          1) .^ (he .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x + R12v .* (1 + (-1) .*  ...
          exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (exp(1) .^ ((-1) ...
           .* d .* u1 + (-1) .* (d + he) .* u1) .* h .^ (-1) .* u1 .^ (-1) .* x +  ...
          exp(1) .^ (((-2) .* d + he) .* u1) .* h .^ (-1) .* R10v .* u1 .^ (-1) .* ...
           x)))))));

        end
    end
                        
    elseif emitter == 2 %med 2
     if medium == 0 %Air or air-med1 interface
        if component == 0; %Hx
           Hint=2 .* exp(1) .^ ((-1) .* pz .* u0 + (-1) .* d .* u1 + (d + he) .* u2) .*  ...
          px .* py .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v)  ...
          .^ (-1) .* rho .^ (-2) .* (k2 .^ 2 .* u1 + k1 .^ 2 .* u2) .^ (-1) .* (( ...
          -1) .* k0 .^ (-2) .* k1 .^ 2 .* k2 .^ 2 .* T10v + u0 .* ((-1) .* k0 .^  ...
          2 .* k2 .^ 2 .* T10h .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) + (u1 +  ...
          u2) .^ (-1) .* ((k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) .* ((-1) .* k1  ...
          .^ 4 .* (1 + R10h) .* u0 + k0 .^ 2 .* k2 .^ 2 .* (1 + R10h) .* u1 + k1  ...
          .^ 2 .* ((-1) .* k0 .^ 2 .* (1 + R10h) .* u1 + k2 .^ 2 .* (u0 + R10h .*  ...
          u0 + T10h .* u1 + T10h .* u2))) + exp(1) .^ ((-2) .* d .* u1) .* (1 +  ...
          R10h) .* ((-1) + exp(1) .^ ((-2) .* d .* u1) .* R10h .* R12h) .^ (-1) .* ...
           (k1 .^ 2 .* (R10v + R10h .* R12h) + (-1) .* k2 .^ 2 .* (R10v + R12h .*  ...
          (R10h + N10 .* T10h .* (u1 + u2))))))) .* x .^ 2 .* ((-2) .* J1 .* rho  ...
          .^ (-1) + h .^ (-1) .* J0 .* x);
        elseif component ==1 %Hy
         Hint=2 .* exp(1) .^ ((-1) .* pz .* u0 + (-1) .* d .* u1 + (d + he) .* u2) .*  ...
          h .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1)  ...
          .* (k2 .^ 2 .* u1 + k1 .^ 2 .* u2) .^ (-1) .* x .* (J0 .* k1 .^ 2 .* k2  ...
          .^ 2 .* T10v + h .^ (-2) .* rho .^ (-3) .* ((-1) .* k0 .^ (-2) .* k1 .^  ...
          2 .* k2 .^ 2 .* T10v + u0 .* ((-1) .* k0 .^ 2 .* k2 .^ 2 .* T10h .* (k1  ...
          .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) + (u1 + u2) .^ (-1) .* ((k1 .^ 2 .*  ...
          u0 + k0 .^ 2 .* u1) .^ (-1) .* ((-1) .* k1 .^ 4 .* (1 + R10h) .* u0 +  ...
          k0 .^ 2 .* k2 .^ 2 .* (1 + R10h) .* u1 + k1 .^ 2 .* ((-1) .* k0 .^ 2 .*  ...
          (1 + R10h) .* u1 + k2 .^ 2 .* (u0 + R10h .* u0 + T10h .* u1 + T10h .*  ...
          u2))) + (1 + R10h) .* ((-1) .* exp(1) .^ (2 .* d .* u1) + R10h .* R12h)  ...
          .^ (-1) .* (k1 .^ 2 .* (R10v + R10h .* R12h) + (-1) .* k2 .^ 2 .* (R10v  ...
          + R12h .* (R10h + N10 .* T10h .* (u1 + u2))))))) .* x .* (h .* J1 .* (( ...
          -2) .* py .^ 2 + rho .^ 2) + J0 .* py .^ 2 .* rho .* x));
        else %Hz
             Hint=2 .* exp(1) .^ ((-1) .* pz .* u0 + (-1) .* d .* u1 + (d + he) .* u2) .*  ...
          h .^ (-2) .* J1 .* py .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .*  ...
          R10v .* R12v) .^ (-1) .* rho .^ (-1) .* (k2 .^ 2 .* u1 + k1 .^ 2 .* u2)  ...
          .^ (-1) .* x .^ 2 .* (h .^ 2 .* k0 .^ (-2) .* k1 .^ 2 .* k2 .^ 2 .*  ...
          T10v .* u0 + (u1 + u2) .^ (-1) .* ((k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ ( ...
          -1) .* (k1 .^ 4 .* (1 + R10h) .* u0 + k0 .^ 2 .* k2 .^ 2 .* (((-1) + ( ...
          -1) .* R10h + T10h) .* u1 + T10h .* u2) + (-1) .* k1 .^ 2 .* ((-1) .*  ...
          k0 .^ 2 .* (1 + R10h) .* u1 + k2 .^ 2 .* (u0 + R10h .* u0 + T10h .* u1 + ...
           T10h .* u2))) + (-1) .* (1 + R10h) .* ((-1) .* exp(1) .^ (2 .* d .* u1) ...
           + R10h .* R12h) .^ (-1) .* (k1 .^ 2 .* (R10v + R10h .* R12h) + (-1) .*  ...
          k2 .^ 2 .* (R10v + R12h .* (R10h + N10 .* T10h .* (u1 + u2))))) .* x .^  ...
          2);
        end

    elseif medium == 1 %med1 or med1-med2 interface
        if component == 0;     %Hx     
          Hint=2 .* exp(1) .^ (((-1) .* d + (-1) .* pz) .* u1 + (d + he) .* u2) .* px  ...
              .* py .* rho .^ (-2) .* (k2 .^ 2 .* u1 + k1 .^ 2 .* u2) .^ (-1) .* ((-1) ...
               .* k2 .^ 2 .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) ...
               .^ (-1) + exp(1) .^ (2 .* pz .* u1) .* k2 .^ 2 .* R10v .* ((-1) + exp( ...
              1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) + (-1) .* (1 + (-1) .*  ...
              exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* u1 .* ((1 + (-1) ...
               .* exp(1) .^ ((-2) .* d .* u1) .* R10h .* R12h) .^ (-1) .* (u1 + u2)  ...
              .^ (-1) .* ((k1 + (-1) .* k2) .* (k1 + k2) + exp(1) .^ ((-2) .* d .* u1) ...
               .* k1 .^ 2 .* R10v + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* k2 .^ 2 .*  ...
              (R10v + N10 .* R12h .* T10h .* (u1 + u2))) + exp(1) .^ (2 .* pz .* u1)  ...
              .* (((-1) .* k0 .^ 2 + k1 .^ 2) .* k2 .^ 2 .* T10h .* (k1 .^ 2 .* u0 +  ...
              k0 .^ 2 .* u1) .^ (-1) + R10h .* ((-1) + exp(1) .^ ((-2) .* d .* u1) .*  ...
              R10h .* R12h) .^ (-1) .* (u1 + u2) .^ (-1) .* ((k1 + (-1) .* k2) .* (k1  ...
              + k2) + exp(1) .^ ((-2) .* d .* u1) .* k1 .^ 2 .* R10v + (-1) .* exp(1)  ...
              .^ ((-2) .* d .* u1) .* k2 .^ 2 .* (R10v + N10 .* R12h .* T10h .* (u1 +  ...
              u2)))))) .* x .^ 2 .* ((-2) .* J1 .* rho .^ (-1) + h .^ (-1) .* J0 .* x);
             
        elseif component == 1; %Hy
                Hint=2 .* exp(1) .^ (((-1) .* d + (-1) .* pz) .* u1 + (d + he) .* u2) .* h .* ...
                   (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* ( ...
                  k2 .^ 2 .* u1 + k1 .^ 2 .* u2) .^ (-1) .* x .* (J0 .* k1 .^ 2 .* k2 .^  ...
                  2 .* (1 + exp(1) .^ (2 .* pz .* u1) .* R10v) + (-1) .* h .^ (-2) .* rho  ...
                  .^ (-3) .* (k2 .^ 2 + exp(1) .^ (2 .* pz .* u1) .* k2 .^ 2 .* R10v + u1  ...
                  .* ((1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10h .* R12h) .^ (-1) .* ...
                   (u1 + u2) .^ (-1) .* ((k1 + (-1) .* k2) .* (k1 + k2) + exp(1) .^ ((-2)  ...
                  .* d .* u1) .* k1 .^ 2 .* R10v + (-1) .* exp(1) .^ ((-2) .* d .* u1) .*  ...
                  k2 .^ 2 .* (R10v + N10 .* R12h .* T10h .* (u1 + u2))) + exp(1) .^ (2 .*  ...
                  pz .* u1) .* (((-1) .* k0 .^ 2 + k1 .^ 2) .* k2 .^ 2 .* T10h .* (k1 .^  ...
                  2 .* u0 + k0 .^ 2 .* u1) .^ (-1) + R10h .* ((-1) + exp(1) .^ ((-2) .* d  ...
                  .* u1) .* R10h .* R12h) .^ (-1) .* (u1 + u2) .^ (-1) .* ((k1 + (-1) .*  ...
                  k2) .* (k1 + k2) + exp(1) .^ ((-2) .* d .* u1) .* k1 .^ 2 .* R10v + (-1) ...
                   .* exp(1) .^ ((-2) .* d .* u1) .* k2 .^ 2 .* (R10v + N10 .* R12h .*  ...
                  T10h .* (u1 + u2)))))) .* x .* (h .* J1 .* ((-2) .* py .^ 2 + rho .^ 2)  ...
                  + J0 .* py .^ 2 .* rho .* x));
        else                    %Hz
       Hint=2 .* exp(1) .^ (((-1) .* d + (-1) .* pz) .* u1 + (d + he) .* u2) .* h  ...
          .^ (-2) .* J1 .* py .* rho .^ (-1) .* (k2 .^ 2 .* u1 + k1 .^ 2 .* u2)  ...
          .^ (-1) .* x .^ 2 .* (h .^ 2 .* k2 .^ 2 .* ((-1) + exp(1) .^ (2 .* pz .* ...
           u1) .* R10v) .* ((-1) + exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v)  ...
          .^ (-1) .* u1 + (-1) .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .*  ...
          R10v .* R12v) .^ (-1) .* ((1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .*  ...
          R10h .* R12h) .^ (-1) .* (u1 + u2) .^ (-1) .* ((-1) .* k1 .^ 2 + k2 .^  ...
          2 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* k1 .^ 2 .* R10v + exp(1) .^ ( ...
          (-2) .* d .* u1) .* k2 .^ 2 .* (R10v + N10 .* R12h .* T10h .* (u1 + u2)) ...
          ) + exp(1) .^ (2 .* pz .* u1) .* (((-1) .* k0 .^ 2 + k1 .^ 2) .* k2 .^  ...
          2 .* T10h .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) + R10h .* ((-1) +  ...
          exp(1) .^ ((-2) .* d .* u1) .* R10h .* R12h) .^ (-1) .* (u1 + u2) .^ ( ...
          -1) .* ((k1 + (-1) .* k2) .* (k1 + k2) + exp(1) .^ ((-2) .* d .* u1) .*  ...
          k1 .^ 2 .* R10v + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* k2 .^ 2 .* ( ...
          R10v + N10 .* R12h .* T10h .* (u1 + u2))))) .* x .^ 2);
         end
    else %med2
        if component == 0; %Hx
            Hint=exp(1) .^ ((2 .* d + he + pz) .* u2) .* px .* py .* rho .^ (-2) .* (u2  ...
              .^ (-1) + (-2) .* k1 .^ 2 .* (1 + exp(1) .^ ((-2) .* d .* u1) .* R10v)  ...
              .* (1 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .*  ...
              (k2 .^ 2 .* u1 + k1 .^ 2 .* u2) .^ (-1) + (-2) .* (1 + (-1) .* exp(1)  ...
              .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* u2 .* (k2 .^ 2 .* u1 +  ...
              k1 .^ 2 .* u2) .^ (-1) .* (exp(1) .^ ((-2) .* d .* u1) .* ((-1) .* k0  ...
              .^ 2 + k1 .^ 2) .* k2 .^ 2 .* T10h .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1)  ...
              .^ (-1) + R10h .* ((-1) .* exp(1) .^ (2 .* d .* u1) + R10h .* R12h) .^ ( ...
              -1) .* (u1 + u2) .^ (-1) .* ((k1 + (-1) .* k2) .* (k1 + k2) + exp(1) .^  ...
              ((-2) .* d .* u1) .* k1 .^ 2 .* R10v + (-1) .* exp(1) .^ ((-2) .* d .*  ...
              u1) .* k2 .^ 2 .* (R10v + N10 .* R12h .* T10h .* (u1 + u2))) + (1 + (-1) ...
               .* exp(1) .^ ((-2) .* d .* u1) .* R10h .* R12h) .^ (-1) .* (u1 + u2)  ...
              .^ (-1) .* ((-1) .* k1 .^ 2 + k2 .^ 2 + (-1) .* exp(1) .^ ((-2) .* d .*  ...
              u1) .* k1 .^ 2 .* R10v + exp(1) .^ ((-2) .* d .* u1) .* k2 .^ 2 .* ( ...
              R10v + N10 .* R12h .* T10h .* (u1 + u2))))) .* x .^ 2 .* ((-2) .* J1 .*  ...
              rho .^ (-1) + h .^ (-1) .* J0 .* x);

        elseif component ==1 %Hy
            Hint = exp(1) .^ ((2 .* d + he + pz) .* u2) .* h .* x .* (J0 .* k2 .^ 2 .* (1 + ...
               (-1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* u2 .^ ( ...
              -1) .* (k2 .^ 2 .* u1 + k1 .^ 2 .* u2) .^ (-1) .* ((-1) .* k2 .^ 2 .*  ...
              u1 + exp(1) .^ ((-2) .* d .* u1) .* k2 .^ 2 .* R10v .* R12v .* u1 + k1  ...
              .^ 2 .* u2 + exp(1) .^ ((-2) .* d .* u1) .* k1 .^ 2 .* R10v .* (2 +  ...
              R12v) .* u2) + (-1) .* h .^ (-2) .* rho .^ (-3) .* ((-1) .* u2 .^ (-1) + ...
               2 .* k1 .^ 2 .* (1 + exp(1) .^ ((-2) .* d .* u1) .* R10v) .* (1 + (-1)  ...
              .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* (k2 .^ 2 .*  ...
              u1 + k1 .^ 2 .* u2) .^ (-1) + 2 .* (1 + (-1) .* exp(1) .^ ((-2) .* d .*  ...
              u1) .* R10v .* R12v) .^ (-1) .* u2 .* (k2 .^ 2 .* u1 + k1 .^ 2 .* u2)  ...
              .^ (-1) .* (exp(1) .^ ((-2) .* d .* u1) .* ((-1) .* k0 .^ 2 + k1 .^ 2)  ...
              .* k2 .^ 2 .* T10h .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) + R10h .*  ...
              ((-1) .* exp(1) .^ (2 .* d .* u1) + R10h .* R12h) .^ (-1) .* (u1 + u2)  ...
              .^ (-1) .* ((k1 + (-1) .* k2) .* (k1 + k2) + exp(1) .^ ((-2) .* d .* u1) ...
               .* k1 .^ 2 .* R10v + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* k2 .^ 2 .*  ...
              (R10v + N10 .* R12h .* T10h .* (u1 + u2))) + (1 + (-1) .* exp(1) .^ (( ...
              -2) .* d .* u1) .* R10h .* R12h) .^ (-1) .* (u1 + u2) .^ (-1) .* ((-1)  ...
              .* k1 .^ 2 + k2 .^ 2 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* k1 .^ 2 .* ...
               R10v + exp(1) .^ ((-2) .* d .* u1) .* k2 .^ 2 .* (R10v + N10 .* R12h .* ...
               T10h .* (u1 + u2))))) .* x .* (h .* J1 .* ((-2) .* py .^ 2 + rho .^ 2)  ...
              + J0 .* py .^ 2 .* rho .* x));
        else %Hz
            Hint = exp(1) .^ ((2 .* d + he + pz) .* u2) .* h .^ (-2) .* J1 .* py .* (1 + ( ...
              -1) .* exp(1) .^ ((-2) .* d .* u1) .* R10v .* R12v) .^ (-1) .* rho .^ ( ...
              -1) .* (k2 .^ 2 .* u1 + k1 .^ 2 .* u2) .^ (-1) .* x .^ 2 .* (h .^ 2 .* ( ...
              k2 .^ 2 .* u1 + (-1) .* k1 .^ 2 .* u2 + (-1) .* exp(1) .^ ((-2) .* d .*  ...
              u1) .* R10v .* (k2 .^ 2 .* R12v .* u1 + k1 .^ 2 .* (2 + R12v) .* u2)) +  ...
              (-2) .* (exp(1) .^ ((-2) .* d .* u1) .* ((-1) .* k0 .^ 2 + k1 .^ 2) .*  ...
              k2 .^ 2 .* T10h .* (k1 .^ 2 .* u0 + k0 .^ 2 .* u1) .^ (-1) + R10h .* (( ...
              -1) .* exp(1) .^ (2 .* d .* u1) + R10h .* R12h) .^ (-1) .* (u1 + u2) .^  ...
              (-1) .* ((k1 + (-1) .* k2) .* (k1 + k2) + exp(1) .^ ((-2) .* d .* u1) .* ...
               k1 .^ 2 .* R10v + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* k2 .^ 2 .* ( ...
              R10v + N10 .* R12h .* T10h .* (u1 + u2))) + (1 + (-1) .* exp(1) .^ ((-2) ...
               .* d .* u1) .* R10h .* R12h) .^ (-1) .* (u1 + u2) .^ (-1) .* ((-1) .*  ...
              k1 .^ 2 + k2 .^ 2 + (-1) .* exp(1) .^ ((-2) .* d .* u1) .* k1 .^ 2 .*  ...
              R10v + exp(1) .^ ((-2) .* d .* u1) .* k2 .^ 2 .* (R10v + N10 .* R12h .*  ...
              T10h .* (u1 + u2)))) .* x .^ 2);
        end
     end
end